{
    "absolute_path_to_file_in_container": "/license-maven-plugin/license-maven-plugin/src/test/java/com/mycila/maven/plugin/license/UpdateMojoTest.java",
    "errors": [
        {
            "line_number": 22,
            "message": "[ERROR] /license-maven-plugin/license-maven-plugin/src/test/java/com/mycila/maven/plugin/license/UpdateMojoTest.java:[22,45] package org.apache.maven.plugin.testing.stubs does not exist",
            "additional_info": "",
            "file_name": "UpdateMojoTest.java",
            "BCs": [],
            "Additions": [],
            "uid": "97bd4564-2f03-51d2-9a2d-afd2b18e14aa"
        }
    ],
    "prompt": "\nThe following Java client code fails: \n'''java\n/**\n * Copyright (C) 2008 Mycila (mathieu.carbou@gmail.com)\n * <p>\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * <p>\n * http://www.apache.org/licenses/LICENSE-2.0\n * <p>\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license;\n\nimport com.google.common.collect.ImmutableMap;\nimport com.google.common.io.Files;\nimport com.mycila.maven.plugin.license.util.FileUtils;\nimport org.apache.maven.plugin.MojoExecutionException;\nimport org.apache.maven.plugin.testing.stubs.MavenProjectStub;\nimport org.junit.jupiter.api.Assertions;\nimport org.junit.jupiter.api.Test;\n\nimport java.io.File;\nimport java.nio.charset.Charset;\nimport java.nio.charset.StandardCharsets;\nimport java.util.LinkedHashMap;\nimport java.util.List;\n\nimport static org.assertj.core.api.Assertions.assertThat;\n\nclass UpdateMojoTest {\n\n  public static final String LS = \"\\n\";\n\n  @Test\n  void test_update() throws Exception {\n    File tmp = new File(\"target/test/update\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/doc1.txt\"), tmp);\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/doc2.txt\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/update/header.txt\";\n    updater.project = new MavenProjectStub();\n    updater.defaultProperties = ImmutableMap.of(\"year\", \"2008\");\n    updater.execute();\n\n    Assertions.assertEquals(FileUtils.read(new File(tmp, \"doc1.txt\"), Charset.defaultCharset()), \"====\\r\\n    My @Copyright license 2 with my-custom-value and 2008 and doc1.txt\\r\\n====\\r\\n\\r\\nsome data\\r\\n\");\n    Assertions.assertEquals(FileUtils.read(new File(tmp, \"doc2.txt\"), Charset.defaultCharset()), \"====\\r\\n    My @Copyright license 2 with my-custom-value and 2008 and doc2.txt\\r\\n====\\r\\n\\r\\nsome data\\r\\n\");\n  }\n\n  @Test\n  void test_update_inlineHeader() throws Exception {\n    File tmp = new File(\"target/test/update-inlineHeader\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/doc1.txt\"), tmp);\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/doc2.txt\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigInlineHeader = FileUtils.read(new File(\"src/test/resources/update/header.txt\"), StandardCharsets.UTF_8);\n    updater.project = new MavenProjectStub();\n    updater.defaultProperties = ImmutableMap.of(\"year\", \"2008\");\n    updater.execute();\n\n    Assertions.assertEquals(\"====\\r\\n    My @Copyright license 2 with my-custom-value and 2008 and doc1.txt\\r\\n====\\r\\n\\r\\nsome data\\r\\n\", FileUtils.read(new File(tmp, \"doc1.txt\"), Charset.defaultCharset()));\n    Assertions.assertEquals(\"====\\r\\n    My @Copyright license 2 with my-custom-value and 2008 and doc2.txt\\r\\n====\\r\\n\\r\\nsome data\\r\\n\", FileUtils.read(new File(tmp, \"doc2.txt\"), Charset.defaultCharset()));\n  }\n\n  @Test\n  void test_skipExistingHeaders() throws Exception {\n    File tmp = new File(\"target/test/test_skipExistingHeaders\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/doc1.txt\"), tmp);\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/doc2.txt\"), tmp);\n\n    // only update those files without a copyright header\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/update/header.txt\";\n    updater.project = new MavenProjectStub();\n    updater.defaultProperties = ImmutableMap.of(\"year\", \"2008\");\n    updater.skipExistingHeaders = true;\n    updater.execute();\n\n    Assertions.assertEquals(\"====\\r\\n    My @Copyright license 2 with my-custom-value and 2008 and doc1.txt\\r\\n====\\r\\n\\r\\nsome data\\r\\n\", FileUtils.read(new File(tmp, \"doc1.txt\"), Charset.defaultCharset()));\n    Assertions.assertEquals(\"====\\r\\n    Copyright license\\r\\n====\\r\\n\\r\\nsome data\\r\\n\", FileUtils.read(new File(tmp, \"doc2.txt\"), Charset.defaultCharset()));\n\n    // expect unchanged header to fail check against new header\n    LicenseCheckMojo check = new LicenseCheckMojo();\n    check.defaultBasedir = tmp;\n    check.legacyConfigHeader = \"src/test/resources/update/header.txt\";\n    check.project = new MavenProjectStub();\n    check.defaultProperties = ImmutableMap.of(\"year\", \"2008\");\n    check.skipExistingHeaders = false;\n\n    try {\n      check.execute();\n      Assertions.fail();\n    } catch (MojoExecutionException e) {\n      Assertions.assertEquals(\"Some files do not have the expected license header. Run license:format to update them.\", e.getMessage());\n      Assertions.assertEquals(1, check.missingHeaders.size());\n    }\n\n    // check again ignoring unchanged headers, should not fail\n    check.skipExistingHeaders = true;\n    check.execute();\n  }\n\n  @Test\n  void test_issue50() throws Exception {\n    File tmp = new File(\"target/test/update/issue50\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue50/test1.properties\"), tmp);\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue50/test2.properties\"), tmp);\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue50/test3.properties\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/update/header.txt\";\n    updater.defaultProperties = ImmutableMap.of(\"year\", \"2008\");\n    updater.mapping = new LinkedHashMap<>() {{\n      put(\"properties\", \"SCRIPT_STYLE\");\n    }};\n    updater.project = new MavenProjectStub();\n    updater.execute();\n\n    String test1 = FileUtils.read(new File(tmp, \"test1.properties\"), Charset.defaultCharset()).replaceAll(\"\\\\n\", LS);\n    String test2 = FileUtils.read(new File(tmp, \"test2.properties\"), Charset.defaultCharset());\n    String test3 = FileUtils.read(new File(tmp, \"test3.properties\"), Charset.defaultCharset());\n\n    Assertions.assertEquals(test1, test2.replace(\"test2.properties\", \"test1.properties\"));\n    Assertions.assertEquals(test1, test3.replace(\"test3.properties\", \"test1.properties\"));\n  }\n\n  @Test\n  void test_issue48() throws Exception {\n    File tmp = new File(\"target/test/update/issue48\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue48/test1.php\"), tmp);\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue48/test2.php\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/update/header.txt\";\n    updater.defaultProperties = ImmutableMap.of(\"year\", \"2008\");\n    updater.mapping = new LinkedHashMap<>() {{\n      put(\"properties\", \"SCRIPT_STYLE\");\n    }};\n    updater.project = new MavenProjectStub();\n    updater.execute();\n\n    Assertions.assertEquals(FileUtils.read(new File(tmp, \"test1.php\"), Charset.defaultCharset()), \"\\r\\n\" +\n        \"\\r\\n\" +\n        \"<?php\\r\\n\" +\n        \"/*\\r\\n\" +\n        \" * My @Copyright license 2 with my-custom-value and 2008 and test1.php\\r\\n\" +\n        \" */\\r\\n\" +\n        \"\\r\\n\" +\n        \"class Conference extends Service {}\\r\\n\" +\n        \"\\r\\n\" +\n        \"?>\\r\\n\");\n    Assertions.assertEquals(FileUtils.read(new File(tmp, \"test2.php\"), Charset.defaultCharset()), \"\\r\\n\" +\n        \"\\r\\n\" +\n        \"<?php\\r\\n\" +\n        \"/*\\r\\n\" +\n        \" * My @Copyright license 2 with my-custom-value and 2008 and test2.php\\r\\n\" +\n        \" */\\r\\n\" +\n        \"\\r\\n\" +\n        \"class Conference extends Service {}\\r\\n\" +\n        \"\\r\\n\" +\n        \"?>\\r\\n\");\n  }\n\n  @Test\n  void test_issue44() throws Exception {\n    File tmp = new File(\"target/test/update/issue44\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue44/issue44-3.rb\"), tmp);\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue44/test.asp\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/update/header.txt\";\n    updater.defaultProperties = ImmutableMap.of(\"year\", \"2008\");\n    updater.project = new MavenProjectStub();\n    updater.execute();\n\n    Assertions.assertEquals(FileUtils.read(new File(tmp, \"issue44-3.rb\"), Charset.defaultCharset()), \"#\" + LS + \"\" +\n        \"# My @Copyright license 2 with my-custom-value and 2008 and issue44-3.rb\" + LS + \"\" +\n        \"#\" + LS + \"\" +\n        \"\" + LS + \"\" +\n        \"# code comment\" + LS + \"\" +\n        \"ruby code here\" + LS + \"\");\n\n    Assertions.assertEquals(\"<%\\n\" +\n        \"' My @Copyright license 2 with my-custom-value and 2008 and test.asp\\n\" +\n        \"%>\" +\n        \"\\n\" +\n        \"asp code\", FileUtils.read(new File(tmp, \"test.asp\"), Charset.defaultCharset()).trim());\n  }\n\n  @Test\n  void test_issue_14() throws Exception {\n    File tmp = new File(\"target/test/update/issue14\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue14/test.properties\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/update/issue14/header.txt\";\n    updater.project = new MavenProjectStub();\n    updater.execute();\n    final String expectedString = \"#\" + LS + \"\" +\n        \"# Copyright (C) 2013 Salzburg Research.\" + LS + \"\" +\n        \"#\" + LS + \"\" +\n        \"# Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\" + LS + \"\" +\n        \"# you may not use this file except in compliance with the License.\" + LS + \"\" +\n        \"# You may obtain a copy of the License at\" + LS + \"\" +\n        \"#\" + LS + \"\" +\n        \"#         http://www.apache.org/licenses/LICENSE-2.0\" + LS + \"\" +\n        \"#\" + LS + \"\" +\n        \"# Unless required by applicable law or agreed to in writing, software\" + LS + \"\" +\n        \"# distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\" + LS + \"\" +\n        \"# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\" + LS + \"\" +\n        \"# See the License for the specific language governing permissions and\" + LS + \"\" +\n        \"# limitations under the License.\" + LS + \"\" +\n        \"#\" + LS + \"\" +\n        \"\" + LS + \"\" +\n        \"meta.tables=SHOW TABLES;\" + LS + \"\" +\n        \"meta.version=SELECT mvalue FROM metadata WHERE mkey = 'version';\" + LS + \"\" +\n        \"# get sequence numbers\" + LS + \"\" +\n        \"seq.nodes=SELECT nextval('seq_nodes')\" + LS + \"\" +\n        \"seq.triples=SELECT nextval('seq_triples')\" + LS + \"\" +\n        \"seq.namespaces=SELECT nextval('seq_namespaces')\" + LS + \"\";\n    final String readModifiedContent = FileUtils.read(new File(tmp, \"test.properties\"), Charset.defaultCharset());\n\n    Assertions.assertEquals(expectedString, readModifiedContent);\n  }\n\n  @Test\n  void test_issue71_canSkipSeveralLines() throws Exception {\n    File tmp = new File(\"target/test/update/issue71\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/issues/issue-71/issue-71.txt.extended\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/issues/issue-71/issue-71-header.txt\";\n    updater.project = new MavenProjectStub();\n    updater.mapping = new LinkedHashMap<>() {{\n      put(\"txt.extended\", \"EXTENDED_STYLE\");\n    }};\n    updater.defaultHeaderDefinitions = new String[]{\"/issues/issue-71/issue-71-additionalHeaderDefinitions.xml\"};\n    updater.execute();\n\n\n    // Check that all the skipable header has been correctly skipped\n    List<String> linesOfModifiedFile = Files.readLines(new File(tmp, \"issue-71.txt.extended\"), Charset.defaultCharset());\n    assertThat(linesOfModifiedFile.get(0) /* line 1 */).isEqualTo(\"|||\");\n    assertThat(linesOfModifiedFile.get(8) /* line 9 */).isEqualTo(\"|||\");\n  }\n\n  @Test\n  void test_issue37_RunningUpdaterTwiceMustNotChangeTheFile() throws Exception {\n    File tmp = new File(\"target/test/update/issue37\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue37/xwiki.xml\"), tmp);\n\n    LicenseFormatMojo execution1 = new LicenseFormatMojo();\n    execution1.defaultBasedir = tmp;\n    execution1.legacyConfigHeader = \"src/test/resources/update/issue37/xwiki-license.txt\";\n    execution1.project = new MavenProjectStub();\n    execution1.execute();\n\n    String execution1FileContent = FileUtils.read(new File(tmp, \"xwiki.xml\"), Charset.defaultCharset());\n\n    LicenseFormatMojo execution2 = new LicenseFormatMojo();\n    execution2.defaultBasedir = tmp;\n    execution2.legacyConfigHeader = \"src/test/resources/update/issue37/xwiki-license.txt\";\n    execution2.project = new MavenProjectStub();\n    execution2.execute();\n\n    String execution2FileContent = FileUtils.read(new File(tmp, \"xwiki.xml\"), Charset.defaultCharset());\n\n    assertThat(execution1FileContent).isEqualTo(execution2FileContent);\n  }\n\n  @Test\n  void test_UpdateWorksHasExpectedOnAOneLineCommentFile_relatesTo_issue30() throws Exception {\n    File tmp = new File(\"target/test/update/issue30\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue30/one-line-comment.ftl\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/single-line-header.txt\";\n    updater.project = new MavenProjectStub();\n    updater.execute();\n\n    List<String> linesOfOriginFile = Files.readLines(new File(\"src/test/resources/update/issue30/one-line-comment.ftl\"), Charset.defaultCharset());\n    List<String> linesOfUpdatedFile = Files.readLines(new File(tmp, \"one-line-comment.ftl\"), Charset.defaultCharset());\n\n    // check that the original line is kept as the latest one even when introducing a license header\n    assertThat(linesOfOriginFile.get(0)).isEqualTo(linesOfUpdatedFile.get(linesOfUpdatedFile.size() - 1));\n  }\n\n\n  @Test\n  /**\n   * Checks that xml with --> on the same line does not become corrupted when license is already correct\n   */\n  void test_issue213() throws Exception {\n    File tmp = new File(\"target/test/update/issue213\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue213/test.xml\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n\n    LicenseSet licenseSet = new LicenseSet();\n    licenseSet.basedir = tmp;\n    licenseSet.inlineHeader = \"All content copyright (c) 2003-2021 Bla, Inc., except as may\\n\" +\n        \"  otherwise be noted in a separate copyright notice. All rights reserved.\";\n    updater.licenseSets = new LicenseSet[]{licenseSet};\n    updater.project = new MavenProjectStub();\n    updater.execute();\n\n    // XML comment gets reformatted but document should still be valid:\n    Assertions.assertEquals(\n        \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n\" +\n            \"<!--\\n\" +\n            \"\\n\" +\n            \"    All content copyright (c) 2003-2021 Bla, Inc., except as may\\n\" +\n            \"      otherwise be noted in a separate copyright notice. All rights reserved.\\n\" +\n            \"\\n\" +\n            \"-->\\n\\n\" +\n            \"<top>\\n\" +\n            \"  <element>value</element>\\n\" +\n            \"</top>\\n\",\n        FileUtils.read(new File(tmp, \"test.xml\"), Charset.defaultCharset())\n    );\n  }\n\n  @Test\n  void test_issue71_underscore_in_package_name() throws Exception {\n    File tmp = new File(\"target/test/update/issue-187\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue-187/Main.java\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/update/issue-187/header.txt\";\n    updater.project = new MavenProjectStub();\n    updater.mapping = new LinkedHashMap<>() {{\n      put(\"java\", \"JAVAPKG_STYLE\");\n    }};\n\n    updater.execute();\n\n    String processed = FileUtils.read(new File(tmp, \"Main.java\"), Charset.defaultCharset());\n    String expected = FileUtils.read(new File(\"src/test/resources/update/issue-187/expected.txt\"), Charset.defaultCharset());\n\n    assertThat(processed).isEqualTo(expected);\n  }\n}\n\n'''\nThe error is caused by a change in the API of the dependency: maven-plugin-testing-harness 4.0.0-alpha-2->4.0.0-beta-3. \nThe new library version includes the following relevant backward incompatible changes on API. \n(API changes format: lines starting with '--' denote removed members, '++' denote added ones, '~~' denote mutations with change kind) \n-- org.apache.maven.plugin.testing.stubs.MavenProjectStub\n-- org.apache.maven.plugin.testing.stubs.ArtifactStub\n\nThe error is triggered in the following specific lines in the previous code:\nimport org.apache.maven.plugin.testing.stubs.MavenProjectStub;\nwith the following error message:\n[ERROR] /license-maven-plugin/license-maven-plugin/src/test/java/com/mycila/maven/plugin/license/UpdateMojoTest.java:[22,45] package org.apache.maven.plugin.testing.stubs does not exist\n\nPlease apply your reasoning and generate the fix following the system instruction.\n",
    "buggy_lines": "import org.apache.maven.plugin.testing.stubs.MavenProjectStub;",
    "error_message": "[ERROR] /license-maven-plugin/license-maven-plugin/src/test/java/com/mycila/maven/plugin/license/UpdateMojoTest.java:[22,45] package org.apache.maven.plugin.testing.stubs does not exist",
    "api_diff": "-- org.apache.maven.plugin.testing.stubs.MavenProjectStub\n-- org.apache.maven.plugin.testing.stubs.ArtifactStub",
    "original_code": "/**\n * Copyright (C) 2008 Mycila (mathieu.carbou@gmail.com)\n * <p>\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * <p>\n * http://www.apache.org/licenses/LICENSE-2.0\n * <p>\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license;\n\nimport com.google.common.collect.ImmutableMap;\nimport com.google.common.io.Files;\nimport com.mycila.maven.plugin.license.util.FileUtils;\nimport org.apache.maven.plugin.MojoExecutionException;\nimport org.apache.maven.plugin.testing.stubs.MavenProjectStub;\nimport org.junit.jupiter.api.Assertions;\nimport org.junit.jupiter.api.Test;\n\nimport java.io.File;\nimport java.nio.charset.Charset;\nimport java.nio.charset.StandardCharsets;\nimport java.util.LinkedHashMap;\nimport java.util.List;\n\nimport static org.assertj.core.api.Assertions.assertThat;\n\nclass UpdateMojoTest {\n\n  public static final String LS = \"\\n\";\n\n  @Test\n  void test_update() throws Exception {\n    File tmp = new File(\"target/test/update\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/doc1.txt\"), tmp);\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/doc2.txt\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/update/header.txt\";\n    updater.project = new MavenProjectStub();\n    updater.defaultProperties = ImmutableMap.of(\"year\", \"2008\");\n    updater.execute();\n\n    Assertions.assertEquals(FileUtils.read(new File(tmp, \"doc1.txt\"), Charset.defaultCharset()), \"====\\r\\n    My @Copyright license 2 with my-custom-value and 2008 and doc1.txt\\r\\n====\\r\\n\\r\\nsome data\\r\\n\");\n    Assertions.assertEquals(FileUtils.read(new File(tmp, \"doc2.txt\"), Charset.defaultCharset()), \"====\\r\\n    My @Copyright license 2 with my-custom-value and 2008 and doc2.txt\\r\\n====\\r\\n\\r\\nsome data\\r\\n\");\n  }\n\n  @Test\n  void test_update_inlineHeader() throws Exception {\n    File tmp = new File(\"target/test/update-inlineHeader\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/doc1.txt\"), tmp);\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/doc2.txt\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigInlineHeader = FileUtils.read(new File(\"src/test/resources/update/header.txt\"), StandardCharsets.UTF_8);\n    updater.project = new MavenProjectStub();\n    updater.defaultProperties = ImmutableMap.of(\"year\", \"2008\");\n    updater.execute();\n\n    Assertions.assertEquals(\"====\\r\\n    My @Copyright license 2 with my-custom-value and 2008 and doc1.txt\\r\\n====\\r\\n\\r\\nsome data\\r\\n\", FileUtils.read(new File(tmp, \"doc1.txt\"), Charset.defaultCharset()));\n    Assertions.assertEquals(\"====\\r\\n    My @Copyright license 2 with my-custom-value and 2008 and doc2.txt\\r\\n====\\r\\n\\r\\nsome data\\r\\n\", FileUtils.read(new File(tmp, \"doc2.txt\"), Charset.defaultCharset()));\n  }\n\n  @Test\n  void test_skipExistingHeaders() throws Exception {\n    File tmp = new File(\"target/test/test_skipExistingHeaders\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/doc1.txt\"), tmp);\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/doc2.txt\"), tmp);\n\n    // only update those files without a copyright header\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/update/header.txt\";\n    updater.project = new MavenProjectStub();\n    updater.defaultProperties = ImmutableMap.of(\"year\", \"2008\");\n    updater.skipExistingHeaders = true;\n    updater.execute();\n\n    Assertions.assertEquals(\"====\\r\\n    My @Copyright license 2 with my-custom-value and 2008 and doc1.txt\\r\\n====\\r\\n\\r\\nsome data\\r\\n\", FileUtils.read(new File(tmp, \"doc1.txt\"), Charset.defaultCharset()));\n    Assertions.assertEquals(\"====\\r\\n    Copyright license\\r\\n====\\r\\n\\r\\nsome data\\r\\n\", FileUtils.read(new File(tmp, \"doc2.txt\"), Charset.defaultCharset()));\n\n    // expect unchanged header to fail check against new header\n    LicenseCheckMojo check = new LicenseCheckMojo();\n    check.defaultBasedir = tmp;\n    check.legacyConfigHeader = \"src/test/resources/update/header.txt\";\n    check.project = new MavenProjectStub();\n    check.defaultProperties = ImmutableMap.of(\"year\", \"2008\");\n    check.skipExistingHeaders = false;\n\n    try {\n      check.execute();\n      Assertions.fail();\n    } catch (MojoExecutionException e) {\n      Assertions.assertEquals(\"Some files do not have the expected license header. Run license:format to update them.\", e.getMessage());\n      Assertions.assertEquals(1, check.missingHeaders.size());\n    }\n\n    // check again ignoring unchanged headers, should not fail\n    check.skipExistingHeaders = true;\n    check.execute();\n  }\n\n  @Test\n  void test_issue50() throws Exception {\n    File tmp = new File(\"target/test/update/issue50\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue50/test1.properties\"), tmp);\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue50/test2.properties\"), tmp);\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue50/test3.properties\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/update/header.txt\";\n    updater.defaultProperties = ImmutableMap.of(\"year\", \"2008\");\n    updater.mapping = new LinkedHashMap<>() {{\n      put(\"properties\", \"SCRIPT_STYLE\");\n    }};\n    updater.project = new MavenProjectStub();\n    updater.execute();\n\n    String test1 = FileUtils.read(new File(tmp, \"test1.properties\"), Charset.defaultCharset()).replaceAll(\"\\\\n\", LS);\n    String test2 = FileUtils.read(new File(tmp, \"test2.properties\"), Charset.defaultCharset());\n    String test3 = FileUtils.read(new File(tmp, \"test3.properties\"), Charset.defaultCharset());\n\n    Assertions.assertEquals(test1, test2.replace(\"test2.properties\", \"test1.properties\"));\n    Assertions.assertEquals(test1, test3.replace(\"test3.properties\", \"test1.properties\"));\n  }\n\n  @Test\n  void test_issue48() throws Exception {\n    File tmp = new File(\"target/test/update/issue48\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue48/test1.php\"), tmp);\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue48/test2.php\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/update/header.txt\";\n    updater.defaultProperties = ImmutableMap.of(\"year\", \"2008\");\n    updater.mapping = new LinkedHashMap<>() {{\n      put(\"properties\", \"SCRIPT_STYLE\");\n    }};\n    updater.project = new MavenProjectStub();\n    updater.execute();\n\n    Assertions.assertEquals(FileUtils.read(new File(tmp, \"test1.php\"), Charset.defaultCharset()), \"\\r\\n\" +\n        \"\\r\\n\" +\n        \"<?php\\r\\n\" +\n        \"/*\\r\\n\" +\n        \" * My @Copyright license 2 with my-custom-value and 2008 and test1.php\\r\\n\" +\n        \" */\\r\\n\" +\n        \"\\r\\n\" +\n        \"class Conference extends Service {}\\r\\n\" +\n        \"\\r\\n\" +\n        \"?>\\r\\n\");\n    Assertions.assertEquals(FileUtils.read(new File(tmp, \"test2.php\"), Charset.defaultCharset()), \"\\r\\n\" +\n        \"\\r\\n\" +\n        \"<?php\\r\\n\" +\n        \"/*\\r\\n\" +\n        \" * My @Copyright license 2 with my-custom-value and 2008 and test2.php\\r\\n\" +\n        \" */\\r\\n\" +\n        \"\\r\\n\" +\n        \"class Conference extends Service {}\\r\\n\" +\n        \"\\r\\n\" +\n        \"?>\\r\\n\");\n  }\n\n  @Test\n  void test_issue44() throws Exception {\n    File tmp = new File(\"target/test/update/issue44\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue44/issue44-3.rb\"), tmp);\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue44/test.asp\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/update/header.txt\";\n    updater.defaultProperties = ImmutableMap.of(\"year\", \"2008\");\n    updater.project = new MavenProjectStub();\n    updater.execute();\n\n    Assertions.assertEquals(FileUtils.read(new File(tmp, \"issue44-3.rb\"), Charset.defaultCharset()), \"#\" + LS + \"\" +\n        \"# My @Copyright license 2 with my-custom-value and 2008 and issue44-3.rb\" + LS + \"\" +\n        \"#\" + LS + \"\" +\n        \"\" + LS + \"\" +\n        \"# code comment\" + LS + \"\" +\n        \"ruby code here\" + LS + \"\");\n\n    Assertions.assertEquals(\"<%\\n\" +\n        \"' My @Copyright license 2 with my-custom-value and 2008 and test.asp\\n\" +\n        \"%>\" +\n        \"\\n\" +\n        \"asp code\", FileUtils.read(new File(tmp, \"test.asp\"), Charset.defaultCharset()).trim());\n  }\n\n  @Test\n  void test_issue_14() throws Exception {\n    File tmp = new File(\"target/test/update/issue14\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue14/test.properties\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/update/issue14/header.txt\";\n    updater.project = new MavenProjectStub();\n    updater.execute();\n    final String expectedString = \"#\" + LS + \"\" +\n        \"# Copyright (C) 2013 Salzburg Research.\" + LS + \"\" +\n        \"#\" + LS + \"\" +\n        \"# Licensed under the Apache License, Version 2.0 (the \\\"License\\\");\" + LS + \"\" +\n        \"# you may not use this file except in compliance with the License.\" + LS + \"\" +\n        \"# You may obtain a copy of the License at\" + LS + \"\" +\n        \"#\" + LS + \"\" +\n        \"#         http://www.apache.org/licenses/LICENSE-2.0\" + LS + \"\" +\n        \"#\" + LS + \"\" +\n        \"# Unless required by applicable law or agreed to in writing, software\" + LS + \"\" +\n        \"# distributed under the License is distributed on an \\\"AS IS\\\" BASIS,\" + LS + \"\" +\n        \"# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\" + LS + \"\" +\n        \"# See the License for the specific language governing permissions and\" + LS + \"\" +\n        \"# limitations under the License.\" + LS + \"\" +\n        \"#\" + LS + \"\" +\n        \"\" + LS + \"\" +\n        \"meta.tables=SHOW TABLES;\" + LS + \"\" +\n        \"meta.version=SELECT mvalue FROM metadata WHERE mkey = 'version';\" + LS + \"\" +\n        \"# get sequence numbers\" + LS + \"\" +\n        \"seq.nodes=SELECT nextval('seq_nodes')\" + LS + \"\" +\n        \"seq.triples=SELECT nextval('seq_triples')\" + LS + \"\" +\n        \"seq.namespaces=SELECT nextval('seq_namespaces')\" + LS + \"\";\n    final String readModifiedContent = FileUtils.read(new File(tmp, \"test.properties\"), Charset.defaultCharset());\n\n    Assertions.assertEquals(expectedString, readModifiedContent);\n  }\n\n  @Test\n  void test_issue71_canSkipSeveralLines() throws Exception {\n    File tmp = new File(\"target/test/update/issue71\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/issues/issue-71/issue-71.txt.extended\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/issues/issue-71/issue-71-header.txt\";\n    updater.project = new MavenProjectStub();\n    updater.mapping = new LinkedHashMap<>() {{\n      put(\"txt.extended\", \"EXTENDED_STYLE\");\n    }};\n    updater.defaultHeaderDefinitions = new String[]{\"/issues/issue-71/issue-71-additionalHeaderDefinitions.xml\"};\n    updater.execute();\n\n\n    // Check that all the skipable header has been correctly skipped\n    List<String> linesOfModifiedFile = Files.readLines(new File(tmp, \"issue-71.txt.extended\"), Charset.defaultCharset());\n    assertThat(linesOfModifiedFile.get(0) /* line 1 */).isEqualTo(\"|||\");\n    assertThat(linesOfModifiedFile.get(8) /* line 9 */).isEqualTo(\"|||\");\n  }\n\n  @Test\n  void test_issue37_RunningUpdaterTwiceMustNotChangeTheFile() throws Exception {\n    File tmp = new File(\"target/test/update/issue37\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue37/xwiki.xml\"), tmp);\n\n    LicenseFormatMojo execution1 = new LicenseFormatMojo();\n    execution1.defaultBasedir = tmp;\n    execution1.legacyConfigHeader = \"src/test/resources/update/issue37/xwiki-license.txt\";\n    execution1.project = new MavenProjectStub();\n    execution1.execute();\n\n    String execution1FileContent = FileUtils.read(new File(tmp, \"xwiki.xml\"), Charset.defaultCharset());\n\n    LicenseFormatMojo execution2 = new LicenseFormatMojo();\n    execution2.defaultBasedir = tmp;\n    execution2.legacyConfigHeader = \"src/test/resources/update/issue37/xwiki-license.txt\";\n    execution2.project = new MavenProjectStub();\n    execution2.execute();\n\n    String execution2FileContent = FileUtils.read(new File(tmp, \"xwiki.xml\"), Charset.defaultCharset());\n\n    assertThat(execution1FileContent).isEqualTo(execution2FileContent);\n  }\n\n  @Test\n  void test_UpdateWorksHasExpectedOnAOneLineCommentFile_relatesTo_issue30() throws Exception {\n    File tmp = new File(\"target/test/update/issue30\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue30/one-line-comment.ftl\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/single-line-header.txt\";\n    updater.project = new MavenProjectStub();\n    updater.execute();\n\n    List<String> linesOfOriginFile = Files.readLines(new File(\"src/test/resources/update/issue30/one-line-comment.ftl\"), Charset.defaultCharset());\n    List<String> linesOfUpdatedFile = Files.readLines(new File(tmp, \"one-line-comment.ftl\"), Charset.defaultCharset());\n\n    // check that the original line is kept as the latest one even when introducing a license header\n    assertThat(linesOfOriginFile.get(0)).isEqualTo(linesOfUpdatedFile.get(linesOfUpdatedFile.size() - 1));\n  }\n\n\n  @Test\n  /**\n   * Checks that xml with --> on the same line does not become corrupted when license is already correct\n   */\n  void test_issue213() throws Exception {\n    File tmp = new File(\"target/test/update/issue213\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue213/test.xml\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n\n    LicenseSet licenseSet = new LicenseSet();\n    licenseSet.basedir = tmp;\n    licenseSet.inlineHeader = \"All content copyright (c) 2003-2021 Bla, Inc., except as may\\n\" +\n        \"  otherwise be noted in a separate copyright notice. All rights reserved.\";\n    updater.licenseSets = new LicenseSet[]{licenseSet};\n    updater.project = new MavenProjectStub();\n    updater.execute();\n\n    // XML comment gets reformatted but document should still be valid:\n    Assertions.assertEquals(\n        \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n\" +\n            \"<!--\\n\" +\n            \"\\n\" +\n            \"    All content copyright (c) 2003-2021 Bla, Inc., except as may\\n\" +\n            \"      otherwise be noted in a separate copyright notice. All rights reserved.\\n\" +\n            \"\\n\" +\n            \"-->\\n\\n\" +\n            \"<top>\\n\" +\n            \"  <element>value</element>\\n\" +\n            \"</top>\\n\",\n        FileUtils.read(new File(tmp, \"test.xml\"), Charset.defaultCharset())\n    );\n  }\n\n  @Test\n  void test_issue71_underscore_in_package_name() throws Exception {\n    File tmp = new File(\"target/test/update/issue-187\");\n    tmp.mkdirs();\n    FileUtils.copyFileToFolder(new File(\"src/test/resources/update/issue-187/Main.java\"), tmp);\n\n    LicenseFormatMojo updater = new LicenseFormatMojo();\n    updater.defaultBasedir = tmp;\n    updater.legacyConfigHeader = \"src/test/resources/update/issue-187/header.txt\";\n    updater.project = new MavenProjectStub();\n    updater.mapping = new LinkedHashMap<>() {{\n      put(\"java\", \"JAVAPKG_STYLE\");\n    }};\n\n    updater.execute();\n\n    String processed = FileUtils.read(new File(tmp, \"Main.java\"), Charset.defaultCharset());\n    String expected = FileUtils.read(new File(\"src/test/resources/update/issue-187/expected.txt\"), Charset.defaultCharset());\n\n    assertThat(processed).isEqualTo(expected);\n  }\n}\n",
    "project": "license-maven-plugin",
    "libraryName": "maven-plugin-testing-harness",
    "libraryGroupID": "org.apache.maven.plugin-testing",
    "newVersion": "4.0.0-beta-3",
    "previousVersion": "4.0.0-alpha-2",
    "breakingCommit": "f3c21936175d1aada8ae02617b66d32a748953f4"
}