{
    "absolute_path_to_file_in_container": "/depclean/depclean-core/src/main/java/se/kth/depclean/core/analysis/ClassFileVisitorUtils.java",
    "errors": [
        {
            "line_number": 97,
            "message": "[ERROR] /depclean/depclean-core/src/main/java/se/kth/depclean/core/analysis/ClassFileVisitorUtils.java:[97,7] cannot find symbol",
            "additional_info": "  symbol:   variable log\n  location: class se.kth.depclean.core.analysis.ClassFileVisitorUtils",
            "file_name": "ClassFileVisitorUtils.java",
            "BCs": [],
            "Additions": [],
            "uid": "9cf896c5-99bd-5ee0-86a1-74d94e0354fd"
        },
        {
            "line_number": 121,
            "message": "[ERROR] /depclean/depclean-core/src/main/java/se/kth/depclean/core/analysis/ClassFileVisitorUtils.java:[121,9] cannot find symbol",
            "additional_info": "  symbol:   variable log\n  location: class se.kth.depclean.core.analysis.ClassFileVisitorUtils",
            "file_name": "ClassFileVisitorUtils.java",
            "BCs": [],
            "Additions": [],
            "uid": "9cf896c5-99bd-5ee0-86a1-74d94e0354fd"
        }
    ],
    "prompt": "\nThe following Java client code fails: \n'''java\npackage se.kth.depclean.core.analysis;\n\n/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *  http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.net.URI;\nimport java.net.URISyntaxException;\nimport java.net.URL;\nimport java.nio.file.Path;\nimport java.nio.file.Paths;\nimport java.util.jar.JarEntry;\nimport java.util.jar.JarInputStream;\nimport lombok.extern.slf4j.Slf4j;\nimport org.codehaus.plexus.util.DirectoryScanner;\n\n/**\n * Utility to visit classes in a library given either as a jar file or an exploded directory.\n */\n@Slf4j\npublic final class ClassFileVisitorUtils {\n\n  private static final String[] CLASS_INCLUDES = {\"**/*.class\"};\n  public static final String CLASS = \".class\";\n\n  /**\n   * Ctor.\n   */\n  private ClassFileVisitorUtils() {\n    // private constructor for utility class\n  }\n\n  /**\n   * Accepts a jar or directory to be analyzed.\n   *\n   * @param url     The jar or directory\n   * @param visitor A {@link ClassFileVisitor}.\n   */\n  public static void accept(URL url, ClassFileVisitor visitor) {\n    if (url.getPath().endsWith(\".jar\")) {\n      acceptJar(url, visitor);\n    } else {\n      final String message = \"Cannot accept visitor on URL: \";\n      if (url.getProtocol().equalsIgnoreCase(\"file\")) {\n        try {\n          File file = new File(new URI(url.toString()));\n          if (file.isDirectory()) {\n            acceptDirectory(file, visitor);\n          } else if (file.exists()) {\n            throw new IllegalArgumentException(message + url + \" because file is not a directory.\");\n          }\n        } catch (URISyntaxException exception) {\n          throw new IllegalArgumentException(message + url, exception);\n        }\n      } else {\n        throw new IllegalArgumentException(message + url + \" because url isn't pointing a file.\");\n      }\n    }\n  }\n\n  /**\n   * Accepts a jar to be analyzed.\n   *\n   * @param url     URL of jar\n   * @param visitor A {@link ClassFileVisitor}.\n   */\n  private static void acceptJar(URL url, ClassFileVisitor visitor) {\n    try (JarInputStream in = new JarInputStream(url.openStream())) {\n      JarEntry entry;\n      while ((entry = in.getNextJarEntry()) != null) { //NOSONAR\n        String name = entry.getName();\n        // ignore files like package-info.class and module-info.class\n        if (name.endsWith(CLASS) && name.indexOf('-') == -1) {\n          visitClass(name, in, visitor);\n        }\n      }\n    } catch (IOException e) {\n      log.error(\"Error analyzing JAR: \" + url);\n    }\n  }\n\n  /**\n   * Accepts a directory to be analyzed.\n   *\n   * @param directory Directory or File to be analyzed.\n   * @param visitor   A {@link ClassFileVisitor}.\n   */\n  private static void acceptDirectory(File directory, ClassFileVisitor visitor) {\n    if (!directory.isDirectory()) {\n      throw new IllegalArgumentException(\"File is not a directory\");\n    }\n    DirectoryScanner scanner = new DirectoryScanner();\n    scanner.setBasedir(directory);\n    scanner.setIncludes(CLASS_INCLUDES);\n    scanner.scan();\n    String[] paths = scanner.getIncludedFiles();\n    for (String path : paths) {\n      File file = new File(directory, path);\n      try (FileInputStream in = new FileInputStream(file)) {\n        visitClass(path, in, visitor);\n      } catch (IOException e) {\n        log.error(\"Error analyzing directory: \" + directory.getAbsolutePath());\n      }\n    }\n  }\n\n  /**\n   * Removes the root folder of the dependency from the path.\n   *\n   * @param path the dependency folder\n   * @return path without the dependency folder\n   */\n  public static String getChild(String path) {\n    Path tmp = Paths.get(path);\n    if (tmp.getNameCount() > 1) {\n      return tmp.subpath(1, tmp.getNameCount()).toString();\n    } else {\n      // impossible to extract child's path\n      return path;\n    }\n  }\n\n  /**\n   * Visits the classes.\n   *\n   * @param path    Path of the class.\n   * @param in      read the input bytes.\n   * @param visitor A {@link ClassFileVisitor}.\n   */\n  private static void visitClass(String path, InputStream in, ClassFileVisitor visitor) {\n    if (!path.endsWith(CLASS)) {\n      throw new IllegalArgumentException(\"Path is not a class\");\n    }\n    path = getChild(path);\n    String className = path.substring(0, path.length() - CLASS.length());\n    className = className.replace(File.separatorChar, '.');\n    visitor.visitClass(className, in);\n  }\n\n}\n\n'''\nThe error is caused by a change in the API of the dependency: guava 31.1-jre->32.0.0-android. \nThe new library version includes the following relevant backward incompatible changes on API. \n(API changes format: lines starting with '--' denote removed members, '++' denote added ones, '~~' denote mutations with change kind) \n-- com.google.common.collect.ImmutableSet.toImmutableSet\n-- com.google.common.collect.ImmutableSortedSetFauxverideShim.toImmutableSet\n\nThe error is triggered in the following specific lines in the previous code:\n      log.error(\"Error analyzing JAR: \" + url);\n        log.error(\"Error analyzing directory: \" + directory.getAbsolutePath());\nwith the following error message:\n[ERROR] /depclean/depclean-core/src/main/java/se/kth/depclean/core/analysis/ClassFileVisitorUtils.java:[97,7] cannot find symbol  symbol:   variable log\n  location: class se.kth.depclean.core.analysis.ClassFileVisitorUtils\n[ERROR] /depclean/depclean-core/src/main/java/se/kth/depclean/core/analysis/ClassFileVisitorUtils.java:[121,9] cannot find symbol  symbol:   variable log\n  location: class se.kth.depclean.core.analysis.ClassFileVisitorUtils\n\nPlease apply your reasoning and generate the fix following the system instruction.\n",
    "buggy_lines": "      log.error(\"Error analyzing JAR: \" + url);\n        log.error(\"Error analyzing directory: \" + directory.getAbsolutePath());",
    "error_message": "[ERROR] /depclean/depclean-core/src/main/java/se/kth/depclean/core/analysis/ClassFileVisitorUtils.java:[97,7] cannot find symbol  symbol:   variable log\n  location: class se.kth.depclean.core.analysis.ClassFileVisitorUtils\n[ERROR] /depclean/depclean-core/src/main/java/se/kth/depclean/core/analysis/ClassFileVisitorUtils.java:[121,9] cannot find symbol  symbol:   variable log\n  location: class se.kth.depclean.core.analysis.ClassFileVisitorUtils",
    "api_diff": "-- com.google.common.collect.ImmutableSet.toImmutableSet\n-- com.google.common.collect.ImmutableSortedSetFauxverideShim.toImmutableSet",
    "original_code": "package se.kth.depclean.core.analysis;\n\n/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *  http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport java.io.File;\nimport java.io.FileInputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.net.URI;\nimport java.net.URISyntaxException;\nimport java.net.URL;\nimport java.nio.file.Path;\nimport java.nio.file.Paths;\nimport java.util.jar.JarEntry;\nimport java.util.jar.JarInputStream;\nimport lombok.extern.slf4j.Slf4j;\nimport org.codehaus.plexus.util.DirectoryScanner;\n\n/**\n * Utility to visit classes in a library given either as a jar file or an exploded directory.\n */\n@Slf4j\npublic final class ClassFileVisitorUtils {\n\n  private static final String[] CLASS_INCLUDES = {\"**/*.class\"};\n  public static final String CLASS = \".class\";\n\n  /**\n   * Ctor.\n   */\n  private ClassFileVisitorUtils() {\n    // private constructor for utility class\n  }\n\n  /**\n   * Accepts a jar or directory to be analyzed.\n   *\n   * @param url     The jar or directory\n   * @param visitor A {@link ClassFileVisitor}.\n   */\n  public static void accept(URL url, ClassFileVisitor visitor) {\n    if (url.getPath().endsWith(\".jar\")) {\n      acceptJar(url, visitor);\n    } else {\n      final String message = \"Cannot accept visitor on URL: \";\n      if (url.getProtocol().equalsIgnoreCase(\"file\")) {\n        try {\n          File file = new File(new URI(url.toString()));\n          if (file.isDirectory()) {\n            acceptDirectory(file, visitor);\n          } else if (file.exists()) {\n            throw new IllegalArgumentException(message + url + \" because file is not a directory.\");\n          }\n        } catch (URISyntaxException exception) {\n          throw new IllegalArgumentException(message + url, exception);\n        }\n      } else {\n        throw new IllegalArgumentException(message + url + \" because url isn't pointing a file.\");\n      }\n    }\n  }\n\n  /**\n   * Accepts a jar to be analyzed.\n   *\n   * @param url     URL of jar\n   * @param visitor A {@link ClassFileVisitor}.\n   */\n  private static void acceptJar(URL url, ClassFileVisitor visitor) {\n    try (JarInputStream in = new JarInputStream(url.openStream())) {\n      JarEntry entry;\n      while ((entry = in.getNextJarEntry()) != null) { //NOSONAR\n        String name = entry.getName();\n        // ignore files like package-info.class and module-info.class\n        if (name.endsWith(CLASS) && name.indexOf('-') == -1) {\n          visitClass(name, in, visitor);\n        }\n      }\n    } catch (IOException e) {\n      log.error(\"Error analyzing JAR: \" + url);\n    }\n  }\n\n  /**\n   * Accepts a directory to be analyzed.\n   *\n   * @param directory Directory or File to be analyzed.\n   * @param visitor   A {@link ClassFileVisitor}.\n   */\n  private static void acceptDirectory(File directory, ClassFileVisitor visitor) {\n    if (!directory.isDirectory()) {\n      throw new IllegalArgumentException(\"File is not a directory\");\n    }\n    DirectoryScanner scanner = new DirectoryScanner();\n    scanner.setBasedir(directory);\n    scanner.setIncludes(CLASS_INCLUDES);\n    scanner.scan();\n    String[] paths = scanner.getIncludedFiles();\n    for (String path : paths) {\n      File file = new File(directory, path);\n      try (FileInputStream in = new FileInputStream(file)) {\n        visitClass(path, in, visitor);\n      } catch (IOException e) {\n        log.error(\"Error analyzing directory: \" + directory.getAbsolutePath());\n      }\n    }\n  }\n\n  /**\n   * Removes the root folder of the dependency from the path.\n   *\n   * @param path the dependency folder\n   * @return path without the dependency folder\n   */\n  public static String getChild(String path) {\n    Path tmp = Paths.get(path);\n    if (tmp.getNameCount() > 1) {\n      return tmp.subpath(1, tmp.getNameCount()).toString();\n    } else {\n      // impossible to extract child's path\n      return path;\n    }\n  }\n\n  /**\n   * Visits the classes.\n   *\n   * @param path    Path of the class.\n   * @param in      read the input bytes.\n   * @param visitor A {@link ClassFileVisitor}.\n   */\n  private static void visitClass(String path, InputStream in, ClassFileVisitor visitor) {\n    if (!path.endsWith(CLASS)) {\n      throw new IllegalArgumentException(\"Path is not a class\");\n    }\n    path = getChild(path);\n    String className = path.substring(0, path.length() - CLASS.length());\n    className = className.replace(File.separatorChar, '.');\n    visitor.visitClass(className, in);\n  }\n\n}\n",
    "project": "depclean",
    "libraryName": "guava",
    "libraryGroupID": "com.google.guava",
    "newVersion": "32.0.0-android",
    "previousVersion": "31.1-jre",
    "breakingCommit": "b86a5f84b44a9b50aee69745886c47123f721de3"
}