{
    "absolute_path_to_file_in_container": "/singer/singer/src/main/java/com/pinterest/singer/reader/ThriftReader.java",
    "errors": [
        {
            "line_number": 23,
            "message": "[ERROR] /singer/singer/src/main/java/com/pinterest/singer/reader/ThriftReader.java:[23,35] cannot find symbol",
            "additional_info": "  symbol:   class TFramedTransport\n  location: package org.apache.thrift.transport",
            "file_name": "ThriftReader.java",
            "BCs": [
                {
                    "element": "org.apache.thrift.transport.TFramedTransport",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [
                "++ public null org.apache.thrift.transport.layered.TFramedTransport",
                "++ public null org.apache.thrift.transport.layered.TFramedTransport",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport,int)",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport,int)",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport)",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport)"
            ],
            "uid": "97109761-fbc0-5bd4-9eee-04c8f7138a9a"
        },
        {
            "line_number": 64,
            "message": "[ERROR] /singer/singer/src/main/java/com/pinterest/singer/reader/ThriftReader.java:[64,17] cannot find symbol",
            "additional_info": "  symbol:   class TFramedTransport\n  location: class com.pinterest.singer.reader.ThriftReader<T>",
            "file_name": "ThriftReader.java",
            "BCs": [
                {
                    "element": "org.apache.thrift.transport.TFramedTransport",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [
                "++ public null org.apache.thrift.transport.layered.TFramedTransport",
                "++ public null org.apache.thrift.transport.layered.TFramedTransport",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport,int)",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport,int)",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport)",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport)"
            ],
            "uid": "ec852309-aef9-51ad-bdf6-0837c29c18e5"
        }
    ],
    "prompt": "\nThe following Java client code fails: \n'''java\n/**\n * Copyright 2019 Pinterest, Inc.\n * \n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * \n *    http://www.apache.org/licenses/LICENSE-2.0\n * \n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.pinterest.singer.reader;\n\nimport com.google.common.base.Preconditions;\nimport com.google.common.base.Strings;\nimport org.apache.thrift.TBase;\nimport org.apache.thrift.TException;\nimport org.apache.thrift.protocol.TProtocol;\nimport org.apache.thrift.transport.TFramedTransport;\nimport org.apache.thrift.transport.TIOStreamTransport;\nimport org.apache.thrift.transport.TTransport;\n\nimport java.io.Closeable;\nimport java.io.IOException;\nimport java.io.RandomAccessFile;\n\n/**\n * Reader that reads Thrift messages of thrift type from a file\n * <p/>\n * This class is NOT thread-safe.\n */\n@SuppressWarnings(\"rawtypes\")\npublic class ThriftReader<T extends TBase> implements Closeable {\n\n  /**\n   * Factory that get a TBase instance of the thrift type to be read.\n   *\n   * @param <T> The thrift message type to be read.\n   */\n  public static interface TBaseFactory<T> {\n\n    T get();\n  }\n\n  /**\n   * Factory that get a TProtocol instance.\n   */\n  public static interface TProtocolFactory {\n\n    TProtocol get(TTransport transport);\n  }\n\n  // Factory that creates empty objects that will be initialized with values from the file.\n  private final TBaseFactory<T> baseFactory;\n\n  // The ByteOffsetInputStream to read from.\n  private final ByteOffsetInputStream byteOffsetInputStream;\n\n  // The framed framedTransport.\n  private final TFramedTransport framedTransport;\n\n  // TProtocol implementation.\n  private final TProtocol protocol;\n\n  public ThriftReader(\n      String path,\n      TBaseFactory<T> baseFactory,\n      TProtocolFactory protocolFactory,\n      int readBufferSize,\n      int maxMessageSize) throws IOException {\n    Preconditions.checkArgument(!Strings.isNullOrEmpty(path));\n    Preconditions.checkNotNull(protocolFactory);\n\n    this.byteOffsetInputStream = new ByteOffsetInputStream(\n        new RandomAccessFile(path, \"r\"), readBufferSize);\n    this.framedTransport = new TFramedTransport(new TIOStreamTransport(this\n        .byteOffsetInputStream), maxMessageSize);\n    this.baseFactory = Preconditions.checkNotNull(baseFactory);\n    this.protocol = protocolFactory.get(this.framedTransport);\n  }\n\n  /**\n   * Read one thrift message.\n   *\n   * @return next thrift message from the reader. null if no thrift message in the reader.\n   * @throws IOException when file error.\n   * @throws TException  when parse error.\n   */\n  public T read() throws IOException, TException {\n    // If frame buffer is empty and we are at EOF of underlying input stream, return null.\n    if (framedTransport.getBytesRemainingInBuffer() == 0 && byteOffsetInputStream.isEOF()) {\n      return null;\n    }\n\n    T t = baseFactory.get();\n    t.read(protocol);\n    return t;\n  }\n\n  /**\n   * @return byte offset of the next message.\n   * @throws IOException on file error.\n   */\n  public long getByteOffset() throws IOException {\n    Preconditions.checkState(\n        byteOffsetInputStream.getByteOffset() >= framedTransport.getBytesRemainingInBuffer());\n    return byteOffsetInputStream.getByteOffset() - framedTransport.getBytesRemainingInBuffer();\n  }\n\n  /**\n   * Set byte offset of the next message to be read.\n   *\n   * @param byteOffset byte offset.\n   * @throws IOException on file error.\n   */\n  public void setByteOffset(long byteOffset) throws IOException {\n    // If we already at the byte offset, return.\n    if (getByteOffset() == byteOffset) {\n      return;\n    }\n\n    // Clear the buffer\n    framedTransport.consumeBuffer(framedTransport.getBytesRemainingInBuffer());\n\n    // Set underlying stream byte offset\n    byteOffsetInputStream.setByteOffset(byteOffset);\n  }\n\n  /**\n   * Close the reader.\n   *\n   * @throws IOException on file error.\n   */\n  public void close() throws IOException {\n    framedTransport.close();\n  }\n}\n\n'''\nThe error is caused by a change in the API of the dependency: libthrift 0.12.0->0.16.0. \nThe new library version includes the following relevant backward incompatible changes on API. \n(API changes format: lines starting with '--' denote removed members, '++' denote added ones, '~~' denote mutations with change kind) \n-- org.apache.thrift.transport.TFramedTransport\n++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport)\n++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport,int)\n++ public null org.apache.thrift.transport.layered.TFramedTransport\n\nThe error is triggered in the following specific lines in the previous code:\nimport org.apache.thrift.transport.TFramedTransport;\n  private final TFramedTransport framedTransport;\nwith the following error message:\n[ERROR] /singer/singer/src/main/java/com/pinterest/singer/reader/ThriftReader.java:[23,35] cannot find symbol  symbol:   class TFramedTransport\n  location: package org.apache.thrift.transport\n[ERROR] /singer/singer/src/main/java/com/pinterest/singer/reader/ThriftReader.java:[64,17] cannot find symbol  symbol:   class TFramedTransport\n  location: class com.pinterest.singer.reader.ThriftReader<T>\n\nPlease apply your reasoning and generate the fix following the system instruction.\n",
    "buggy_lines": "import org.apache.thrift.transport.TFramedTransport;\n  private final TFramedTransport framedTransport;",
    "error_message": "[ERROR] /singer/singer/src/main/java/com/pinterest/singer/reader/ThriftReader.java:[23,35] cannot find symbol  symbol:   class TFramedTransport\n  location: package org.apache.thrift.transport\n[ERROR] /singer/singer/src/main/java/com/pinterest/singer/reader/ThriftReader.java:[64,17] cannot find symbol  symbol:   class TFramedTransport\n  location: class com.pinterest.singer.reader.ThriftReader<T>",
    "api_diff": "-- org.apache.thrift.transport.TFramedTransport\n++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport)\n++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport,int)\n++ public null org.apache.thrift.transport.layered.TFramedTransport",
    "original_code": "/**\n * Copyright 2019 Pinterest, Inc.\n * \n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * \n *    http://www.apache.org/licenses/LICENSE-2.0\n * \n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.pinterest.singer.reader;\n\nimport com.google.common.base.Preconditions;\nimport com.google.common.base.Strings;\nimport org.apache.thrift.TBase;\nimport org.apache.thrift.TException;\nimport org.apache.thrift.protocol.TProtocol;\nimport org.apache.thrift.transport.TFramedTransport;\nimport org.apache.thrift.transport.TIOStreamTransport;\nimport org.apache.thrift.transport.TTransport;\n\nimport java.io.Closeable;\nimport java.io.IOException;\nimport java.io.RandomAccessFile;\n\n/**\n * Reader that reads Thrift messages of thrift type from a file\n * <p/>\n * This class is NOT thread-safe.\n */\n@SuppressWarnings(\"rawtypes\")\npublic class ThriftReader<T extends TBase> implements Closeable {\n\n  /**\n   * Factory that get a TBase instance of the thrift type to be read.\n   *\n   * @param <T> The thrift message type to be read.\n   */\n  public static interface TBaseFactory<T> {\n\n    T get();\n  }\n\n  /**\n   * Factory that get a TProtocol instance.\n   */\n  public static interface TProtocolFactory {\n\n    TProtocol get(TTransport transport);\n  }\n\n  // Factory that creates empty objects that will be initialized with values from the file.\n  private final TBaseFactory<T> baseFactory;\n\n  // The ByteOffsetInputStream to read from.\n  private final ByteOffsetInputStream byteOffsetInputStream;\n\n  // The framed framedTransport.\n  private final TFramedTransport framedTransport;\n\n  // TProtocol implementation.\n  private final TProtocol protocol;\n\n  public ThriftReader(\n      String path,\n      TBaseFactory<T> baseFactory,\n      TProtocolFactory protocolFactory,\n      int readBufferSize,\n      int maxMessageSize) throws IOException {\n    Preconditions.checkArgument(!Strings.isNullOrEmpty(path));\n    Preconditions.checkNotNull(protocolFactory);\n\n    this.byteOffsetInputStream = new ByteOffsetInputStream(\n        new RandomAccessFile(path, \"r\"), readBufferSize);\n    this.framedTransport = new TFramedTransport(new TIOStreamTransport(this\n        .byteOffsetInputStream), maxMessageSize);\n    this.baseFactory = Preconditions.checkNotNull(baseFactory);\n    this.protocol = protocolFactory.get(this.framedTransport);\n  }\n\n  /**\n   * Read one thrift message.\n   *\n   * @return next thrift message from the reader. null if no thrift message in the reader.\n   * @throws IOException when file error.\n   * @throws TException  when parse error.\n   */\n  public T read() throws IOException, TException {\n    // If frame buffer is empty and we are at EOF of underlying input stream, return null.\n    if (framedTransport.getBytesRemainingInBuffer() == 0 && byteOffsetInputStream.isEOF()) {\n      return null;\n    }\n\n    T t = baseFactory.get();\n    t.read(protocol);\n    return t;\n  }\n\n  /**\n   * @return byte offset of the next message.\n   * @throws IOException on file error.\n   */\n  public long getByteOffset() throws IOException {\n    Preconditions.checkState(\n        byteOffsetInputStream.getByteOffset() >= framedTransport.getBytesRemainingInBuffer());\n    return byteOffsetInputStream.getByteOffset() - framedTransport.getBytesRemainingInBuffer();\n  }\n\n  /**\n   * Set byte offset of the next message to be read.\n   *\n   * @param byteOffset byte offset.\n   * @throws IOException on file error.\n   */\n  public void setByteOffset(long byteOffset) throws IOException {\n    // If we already at the byte offset, return.\n    if (getByteOffset() == byteOffset) {\n      return;\n    }\n\n    // Clear the buffer\n    framedTransport.consumeBuffer(framedTransport.getBytesRemainingInBuffer());\n\n    // Set underlying stream byte offset\n    byteOffsetInputStream.setByteOffset(byteOffset);\n  }\n\n  /**\n   * Close the reader.\n   *\n   * @throws IOException on file error.\n   */\n  public void close() throws IOException {\n    framedTransport.close();\n  }\n}\n",
    "project": "singer",
    "libraryName": "libthrift",
    "libraryGroupID": "org.apache.thrift",
    "newVersion": "0.16.0",
    "previousVersion": "0.12.0",
    "breakingCommit": "867e69e208ff59d1f8baae7ed41d3e163a51bc65"
}