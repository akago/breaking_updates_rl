{
    "absolute_path_to_file_in_container": "/liquibase-mssql/src/java/liquibase/ext/mssql/sqlgenerator/AddPrimaryKeyGeneratorMSSQL.java",
    "errors": [
        {
            "line_number": 12,
            "message": "[ERROR] /liquibase-mssql/src/java/liquibase/ext/mssql/sqlgenerator/AddPrimaryKeyGeneratorMSSQL.java:[12,22] cannot find symbol",
            "additional_info": "  symbol:   class StringUtils\n  location: package liquibase.util",
            "file_name": "AddPrimaryKeyGeneratorMSSQL.java",
            "BCs": [
                {
                    "element": "liquibase.util.StringUtils",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [
                "++ public StringUtils liquibase.repackaged.org.apache.commons.lang3.StringUtils()",
                "++ public StringUtils liquibase.repackaged.org.apache.commons.lang3.StringUtils()"
            ],
            "uid": "91809d44-1ace-5b35-9003-62111f92db56"
        },
        {
            "line_number": 67,
            "message": "[ERROR] /liquibase-mssql/src/java/liquibase/ext/mssql/sqlgenerator/AddPrimaryKeyGeneratorMSSQL.java:[67,9] cannot find symbol",
            "additional_info": "  symbol:   variable StringUtils\n  location: class liquibase.ext.mssql.sqlgenerator.AddPrimaryKeyGeneratorMSSQL",
            "file_name": "AddPrimaryKeyGeneratorMSSQL.java",
            "BCs": [
                {
                    "element": "liquibase.util.StringUtils",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [
                "++ public StringUtils liquibase.repackaged.org.apache.commons.lang3.StringUtils()",
                "++ public StringUtils liquibase.repackaged.org.apache.commons.lang3.StringUtils()"
            ],
            "uid": "9ed4f581-2a5d-51e2-89c7-eba3cb92d736"
        }
    ],
    "prompt": "\nThe following Java client code fails: \n'''java\npackage liquibase.ext.mssql.sqlgenerator;\n\nimport liquibase.database.Database;\nimport liquibase.ext.mssql.database.MSSQLDatabase;\nimport liquibase.ext.mssql.statement.AddPrimaryKeyStatementMSSQL;\nimport liquibase.sql.Sql;\nimport liquibase.sql.UnparsedSql;\nimport liquibase.sqlgenerator.SqlGeneratorChain;\nimport liquibase.sqlgenerator.core.AddPrimaryKeyGenerator;\nimport liquibase.statement.core.AddPrimaryKeyStatement;\nimport liquibase.structure.core.Index;\nimport liquibase.util.StringUtils;\n\npublic class AddPrimaryKeyGeneratorMSSQL extends AddPrimaryKeyGenerator {\n  @Override\n  public int getPriority() {\n    return 15;\n  }\n\n  /**\n   * Conditionally executes to extension's custom Primary Key SQL generation process if statement is the\n   * AddPrimaryKeyStatementMSSQL implementation and the custom attribute (fillFactor) is set.\n   *\n   * Otherwise, defers to default liquibase implementation.\n   *\n   * @param statement\n   * @param database\n   * @param sqlGeneratorChain\n   * @return\n   */\n  @Override\n  public Sql[] generateSql(AddPrimaryKeyStatement statement, Database database, SqlGeneratorChain sqlGeneratorChain) {\n    if (statement instanceof AddPrimaryKeyStatementMSSQL && ((AddPrimaryKeyStatementMSSQL) statement).getFillFactor() != null) {\n      return generateMSSQLSql((AddPrimaryKeyStatementMSSQL)statement, database, sqlGeneratorChain);\n    }\n\n    return super.generateSql(statement, database, sqlGeneratorChain);\n  }\n\n  /**\n   * The extension's implementation is essentially a copy/paste of the default implementation, with the following changes:\n   *\n   * 1) Removed other database platform specific logic other than MSSQL (purely to simplify)\n   *\n   * 2) Added support for setting fillFactor\n   *\n   * @param statement\n   * @param database\n   * @param sqlGeneratorChain\n   * @return\n   */\n  private Sql[] generateMSSQLSql(AddPrimaryKeyStatementMSSQL statement, Database database, SqlGeneratorChain sqlGeneratorChain) {\n    String sql;\n    if (statement.getConstraintName() == null) {\n      sql = \"ALTER TABLE \" + database.escapeTableName(statement.getCatalogName(), statement.getSchemaName(), statement.getTableName()) + \" ADD PRIMARY KEY (\" + database.escapeColumnNameList(statement.getColumnNames()) + \")\";\n    } else {\n      sql = \"ALTER TABLE \" + database.escapeTableName(statement.getCatalogName(), statement.getSchemaName(), statement.getTableName()) + \" ADD CONSTRAINT \" + database.escapeConstraintName(statement.getConstraintName())+\" PRIMARY KEY\";\n      if (!statement.isClustered()) {\n        sql += \" NONCLUSTERED\";\n      }\n      sql += \" (\" + database.escapeColumnNameList(statement.getColumnNames()) + \")\";\n    }\n\n    // the only new feature being added is support for fillFactor\n    sql += \" WITH (FILLFACTOR = \" + statement.getFillFactor() + \")\";\n\n    if (StringUtils.trimToNull(statement.getTablespace()) != null && database.supportsTablespaces()) {\n      sql += \" ON \"+statement.getTablespace();\n    }\n\n    if (statement.getForIndexName() != null) {\n      sql += \" USING INDEX \"+database.escapeObjectName(statement.getForIndexCatalogName(), statement.getForIndexSchemaName(), statement.getForIndexName(), Index.class);\n    }\n\n    return new Sql[] {\n        new UnparsedSql(sql, getAffectedPrimaryKey(statement))\n    };\n  }\n\n  @Override\n  public boolean supports(AddPrimaryKeyStatement statement, Database database) {\n    return database instanceof MSSQLDatabase;\n  }\n\n}\n\n'''\nThe error is caused by a change in the API of the dependency: liquibase-core 3.4.2->4.8.0. \nThe new library version includes the following relevant backward incompatible changes on API. \n(API changes format: lines starting with '--' denote removed members, '++' denote added ones, '~~' denote mutations with change kind) \n-- liquibase.util.StringUtils\n++ METHOD_ABSTRACT_ADDED_TO_CLASS <- liquibase.executor.ExecutorService\n++ METHOD_ADDED_TO_INTERFACE <- liquibase.database.Database\n-- liquibase.servicelocator.ServiceLocator.getInstance\n~~ METHOD_NOW_FINAL <- liquibase.logging.LogFactory.getInstance\n-- liquibase.executor.ExecutorService.getInstance\n++ public final null liquibase.repackaged.net.sf.jsqlparser.schema.Database\n++ public static liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat.getInstance(java.lang.String)\n++ public static liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat.getInstance(java.lang.String,java.util.TimeZone)\n++ public static transient liquibase.repackaged.org.apache.commons.lang3.CharSet liquibase.repackaged.org.apache.commons.lang3.CharSet.getInstance(java.lang.String[])\n++ public static liquibase.pro.packaged.iI liquibase.pro.packaged.iI.getInstance()\n++ public static synchronized liquibase.database.ConnectionServiceFactory liquibase.database.ConnectionServiceFactory.getInstance()\n++ public static liquibase.pro.packaged.iD liquibase.pro.packaged.iD.getInstance()\n++ public Database liquibase.repackaged.net.sf.jsqlparser.schema.Database(java.lang.String)\n++ public StringUtils liquibase.repackaged.org.apache.commons.lang3.StringUtils()\n++ public static liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat.getInstance(java.lang.String,java.util.TimeZone,java.util.Locale)\n++ public Index liquibase.repackaged.net.sf.jsqlparser.statement.create.table.Index()\n++ public static liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat.getInstance(java.lang.String,java.util.Locale)\n++ public Database liquibase.repackaged.net.sf.jsqlparser.schema.Database(liquibase.repackaged.net.sf.jsqlparser.schema.Server,java.lang.String)\n++ public static liquibase.pro.packaged.aZ liquibase.pro.packaged.aZ.getInstance()\n++ public static liquibase.command.CommandFactory liquibase.command.CommandFactory.getInstance()\n++ public static liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat.getInstance()\n++ public final liquibase.repackaged.net.sf.jsqlparser.statement.create.table.Index liquibase.repackaged.net.sf.jsqlparser.parser.CCJSqlParser.Index()\n\nThe error is triggered in the following specific lines in the previous code:\nimport liquibase.util.StringUtils;\n    if (StringUtils.trimToNull(statement.getTablespace()) != null && database.supportsTablespaces()) {\nwith the following error message:\n[ERROR] /liquibase-mssql/src/java/liquibase/ext/mssql/sqlgenerator/AddPrimaryKeyGeneratorMSSQL.java:[12,22] cannot find symbol  symbol:   class StringUtils\n  location: package liquibase.util\n[ERROR] /liquibase-mssql/src/java/liquibase/ext/mssql/sqlgenerator/AddPrimaryKeyGeneratorMSSQL.java:[67,9] cannot find symbol  symbol:   variable StringUtils\n  location: class liquibase.ext.mssql.sqlgenerator.AddPrimaryKeyGeneratorMSSQL\n\nPlease apply your reasoning and generate the fix following the system instruction.\n",
    "buggy_lines": "import liquibase.util.StringUtils;\n    if (StringUtils.trimToNull(statement.getTablespace()) != null && database.supportsTablespaces()) {",
    "error_message": "[ERROR] /liquibase-mssql/src/java/liquibase/ext/mssql/sqlgenerator/AddPrimaryKeyGeneratorMSSQL.java:[12,22] cannot find symbol  symbol:   class StringUtils\n  location: package liquibase.util\n[ERROR] /liquibase-mssql/src/java/liquibase/ext/mssql/sqlgenerator/AddPrimaryKeyGeneratorMSSQL.java:[67,9] cannot find symbol  symbol:   variable StringUtils\n  location: class liquibase.ext.mssql.sqlgenerator.AddPrimaryKeyGeneratorMSSQL",
    "api_diff": "-- liquibase.util.StringUtils\n++ METHOD_ABSTRACT_ADDED_TO_CLASS <- liquibase.executor.ExecutorService\n++ METHOD_ADDED_TO_INTERFACE <- liquibase.database.Database\n-- liquibase.servicelocator.ServiceLocator.getInstance\n~~ METHOD_NOW_FINAL <- liquibase.logging.LogFactory.getInstance\n-- liquibase.executor.ExecutorService.getInstance\n++ public final null liquibase.repackaged.net.sf.jsqlparser.schema.Database\n++ public static liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat.getInstance(java.lang.String)\n++ public static liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat.getInstance(java.lang.String,java.util.TimeZone)\n++ public static transient liquibase.repackaged.org.apache.commons.lang3.CharSet liquibase.repackaged.org.apache.commons.lang3.CharSet.getInstance(java.lang.String[])\n++ public static liquibase.pro.packaged.iI liquibase.pro.packaged.iI.getInstance()\n++ public static synchronized liquibase.database.ConnectionServiceFactory liquibase.database.ConnectionServiceFactory.getInstance()\n++ public static liquibase.pro.packaged.iD liquibase.pro.packaged.iD.getInstance()\n++ public Database liquibase.repackaged.net.sf.jsqlparser.schema.Database(java.lang.String)\n++ public StringUtils liquibase.repackaged.org.apache.commons.lang3.StringUtils()\n++ public static liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat.getInstance(java.lang.String,java.util.TimeZone,java.util.Locale)\n++ public Index liquibase.repackaged.net.sf.jsqlparser.statement.create.table.Index()\n++ public static liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat.getInstance(java.lang.String,java.util.Locale)\n++ public Database liquibase.repackaged.net.sf.jsqlparser.schema.Database(liquibase.repackaged.net.sf.jsqlparser.schema.Server,java.lang.String)\n++ public static liquibase.pro.packaged.aZ liquibase.pro.packaged.aZ.getInstance()\n++ public static liquibase.command.CommandFactory liquibase.command.CommandFactory.getInstance()\n++ public static liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat liquibase.repackaged.org.apache.commons.lang3.time.FastDateFormat.getInstance()\n++ public final liquibase.repackaged.net.sf.jsqlparser.statement.create.table.Index liquibase.repackaged.net.sf.jsqlparser.parser.CCJSqlParser.Index()",
    "original_code": "package liquibase.ext.mssql.sqlgenerator;\n\nimport liquibase.database.Database;\nimport liquibase.ext.mssql.database.MSSQLDatabase;\nimport liquibase.ext.mssql.statement.AddPrimaryKeyStatementMSSQL;\nimport liquibase.sql.Sql;\nimport liquibase.sql.UnparsedSql;\nimport liquibase.sqlgenerator.SqlGeneratorChain;\nimport liquibase.sqlgenerator.core.AddPrimaryKeyGenerator;\nimport liquibase.statement.core.AddPrimaryKeyStatement;\nimport liquibase.structure.core.Index;\nimport liquibase.util.StringUtils;\n\npublic class AddPrimaryKeyGeneratorMSSQL extends AddPrimaryKeyGenerator {\n  @Override\n  public int getPriority() {\n    return 15;\n  }\n\n  /**\n   * Conditionally executes to extension's custom Primary Key SQL generation process if statement is the\n   * AddPrimaryKeyStatementMSSQL implementation and the custom attribute (fillFactor) is set.\n   *\n   * Otherwise, defers to default liquibase implementation.\n   *\n   * @param statement\n   * @param database\n   * @param sqlGeneratorChain\n   * @return\n   */\n  @Override\n  public Sql[] generateSql(AddPrimaryKeyStatement statement, Database database, SqlGeneratorChain sqlGeneratorChain) {\n    if (statement instanceof AddPrimaryKeyStatementMSSQL && ((AddPrimaryKeyStatementMSSQL) statement).getFillFactor() != null) {\n      return generateMSSQLSql((AddPrimaryKeyStatementMSSQL)statement, database, sqlGeneratorChain);\n    }\n\n    return super.generateSql(statement, database, sqlGeneratorChain);\n  }\n\n  /**\n   * The extension's implementation is essentially a copy/paste of the default implementation, with the following changes:\n   *\n   * 1) Removed other database platform specific logic other than MSSQL (purely to simplify)\n   *\n   * 2) Added support for setting fillFactor\n   *\n   * @param statement\n   * @param database\n   * @param sqlGeneratorChain\n   * @return\n   */\n  private Sql[] generateMSSQLSql(AddPrimaryKeyStatementMSSQL statement, Database database, SqlGeneratorChain sqlGeneratorChain) {\n    String sql;\n    if (statement.getConstraintName() == null) {\n      sql = \"ALTER TABLE \" + database.escapeTableName(statement.getCatalogName(), statement.getSchemaName(), statement.getTableName()) + \" ADD PRIMARY KEY (\" + database.escapeColumnNameList(statement.getColumnNames()) + \")\";\n    } else {\n      sql = \"ALTER TABLE \" + database.escapeTableName(statement.getCatalogName(), statement.getSchemaName(), statement.getTableName()) + \" ADD CONSTRAINT \" + database.escapeConstraintName(statement.getConstraintName())+\" PRIMARY KEY\";\n      if (!statement.isClustered()) {\n        sql += \" NONCLUSTERED\";\n      }\n      sql += \" (\" + database.escapeColumnNameList(statement.getColumnNames()) + \")\";\n    }\n\n    // the only new feature being added is support for fillFactor\n    sql += \" WITH (FILLFACTOR = \" + statement.getFillFactor() + \")\";\n\n    if (StringUtils.trimToNull(statement.getTablespace()) != null && database.supportsTablespaces()) {\n      sql += \" ON \"+statement.getTablespace();\n    }\n\n    if (statement.getForIndexName() != null) {\n      sql += \" USING INDEX \"+database.escapeObjectName(statement.getForIndexCatalogName(), statement.getForIndexSchemaName(), statement.getForIndexName(), Index.class);\n    }\n\n    return new Sql[] {\n        new UnparsedSql(sql, getAffectedPrimaryKey(statement))\n    };\n  }\n\n  @Override\n  public boolean supports(AddPrimaryKeyStatement statement, Database database) {\n    return database instanceof MSSQLDatabase;\n  }\n\n}\n",
    "project": "liquibase-mssql",
    "libraryName": "liquibase-core",
    "libraryGroupID": "org.liquibase",
    "newVersion": "4.8.0",
    "previousVersion": "3.4.2",
    "breakingCommit": "feb582661e77de66eadaa7550720a8751b266ee4"
}