{
    "absolute_path_to_file_in_container": "/sign-maven-plugin/src/main/java/org/simplify4u/plugins/sign/KeyInfoFactory.java",
    "errors": [
        {
            "line_number": 37,
            "message": "[ERROR] /sign-maven-plugin/src/main/java/org/simplify4u/plugins/sign/KeyInfoFactory.java:[37,53] package org.sonatype.plexus.components.sec.dispatcher does not exist",
            "additional_info": "",
            "file_name": "KeyInfoFactory.java",
            "BCs": [],
            "Additions": [],
            "uid": "4c988092-93d9-5bb6-bbd8-818bcee096bc"
        },
        {
            "line_number": 55,
            "message": "[ERROR] /sign-maven-plugin/src/main/java/org/simplify4u/plugins/sign/KeyInfoFactory.java:[55,13] cannot find symbol",
            "additional_info": "  symbol:   class SecDispatcher\n  location: class org.simplify4u.plugins.sign.KeyInfoFactory",
            "file_name": "KeyInfoFactory.java",
            "BCs": [
                {
                    "element": "org.sonatype.plexus.components.sec.dispatcher.SecDispatcher",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [],
            "uid": "36b29499-0d7e-578f-8043-d6dc14ad2010"
        }
    ],
    "prompt": "\nThe following Java client code fails: \n'''java\n/*\n * Copyright 2021 Slawomir Jaranowski\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.simplify4u.plugins.sign;\n\nimport java.io.File;\nimport java.math.BigInteger;\nimport java.nio.charset.StandardCharsets;\nimport java.nio.file.Files;\nimport java.util.Optional;\nimport javax.inject.Inject;\nimport javax.inject.Named;\nimport javax.inject.Singleton;\n\nimport io.vavr.control.Try;\nimport lombok.Builder;\nimport lombok.Value;\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.settings.Server;\nimport org.apache.maven.settings.Settings;\nimport org.simplify4u.plugins.sign.openpgp.PGPKeyInfo;\nimport org.simplify4u.plugins.sign.utils.Environment;\nimport org.simplify4u.plugins.sign.utils.FileUtil;\nimport org.sonatype.plexus.components.sec.dispatcher.SecDispatcher;\n\n/**\n * Service to build {@link PGPKeyInfo} object.\n */\n@Singleton\n@Named\n@Slf4j\npublic class KeyInfoFactory {\n\n    private static final String SIGN_KEY_ID_ENV = \"SIGN_KEY_ID\";\n    private static final String SIGN_KEY_ENV = \"SIGN_KEY\";\n    private static final String SIGN_KEY_PASS_ENV = \"SIGN_KEY_PASS\";\n\n    @Inject\n    private Environment environment;\n\n    @Inject\n    private SecDispatcher secDispatcher;\n\n    @Inject\n    private MavenSession mavenSession;\n\n    /**\n     * Value class for data needed to build key info.\n     */\n    @Value\n    @Builder\n    public static class KeyInfoRequest {\n\n        String serverId;\n        String id;\n        String pass;\n        File file;\n    }\n\n    /**\n     * Build {@link PGPKeyInfo}.\n     *\n     * @param keyInfoRequest input data for key\n     *\n     * @return a {@link PGPKeyInfo} with resolved data.\n     */\n    public PGPKeyInfo buildKeyInfo(KeyInfoRequest keyInfoRequest) {\n\n        final String id;\n        final String pass;\n        final File keyFile;\n\n        // serverId was provided - so all data will be read from settings\n        if (keyInfoRequest.getServerId() != null) {\n            Settings settings = mavenSession.getSettings();\n            Optional<Server> server = Optional.ofNullable(settings.getServer(keyInfoRequest.getServerId()));\n            if (server.isPresent()) {\n                LOGGER.debug(\"server id: {} found - read key info from settings.xml\", keyInfoRequest.getServerId());\n            } else {\n                LOGGER.debug(\"server id: {} not found in settings.xml\", keyInfoRequest.getServerId());\n            }\n            id = server.map(Server::getUsername).orElse(null);\n            pass = server.map(Server::getPassphrase).orElse(null);\n            keyFile = server.map(Server::getPrivateKey).map(File::new).orElse(null);\n        } else {\n            id = keyInfoRequest.getId();\n            pass = keyInfoRequest.getPass();\n            keyFile = keyInfoRequest.getFile();\n        }\n\n        return PGPKeyInfo.builder()\n                .id(resolveKeyId(id))\n                .pass(resolveKeyPass(pass))\n                .key(resolveKey(keyFile))\n                .build();\n    }\n\n    private Long resolveKeyId(String id) {\n        return Optional.ofNullable(environment.getEnv(SIGN_KEY_ID_ENV).orElse(id))\n                .map(KeyInfoFactory::parseKeyId)\n                .orElse(null);\n    }\n\n    private String resolveKeyPass(String pass) {\n        return Optional.ofNullable(environment.getEnv(SIGN_KEY_PASS_ENV).orElse(pass))\n                .map(this::decryptPass)\n                .orElse(null);\n    }\n\n    private byte[] resolveKey(File keyFile) {\n        return environment.getEnv(SIGN_KEY_ENV)\n                .map(String::trim)\n                .map(KeyInfoFactory::keyFromString)\n                .orElseGet(() -> keyFromFile(keyFile));\n    }\n\n    private String decryptPass(String pass) {\n        return Try.of(() -> secDispatcher.decrypt(pass))\n                .getOrElseThrow(e -> new SignMojoException(\"Invalid encrypted password: \" + e.getMessage()));\n    }\n\n    private static long parseKeyId(String key) {\n        return Try.of(() -> new BigInteger(key, 16))\n                .map(BigInteger::longValue)\n                .getOrElseThrow(e -> new SignMojoException(\"Invalid keyId: \" + e.getMessage()));\n    }\n\n    private static byte[] keyFromString(String key) {\n        return key.getBytes(StandardCharsets.US_ASCII);\n    }\n\n    private static byte[] keyFromFile(File keyFile) {\n\n        if (keyFile != null) {\n            File file = FileUtil.calculateWithUserHome(keyFile);\n\n            if (file.exists()) {\n                LOGGER.debug(\"Read key from file: {}\", file);\n                return Try.of(() -> Files.readAllBytes(file.toPath())).get();\n            } else {\n                LOGGER.debug(\"Key file: {} not exist\", keyFile);\n            }\n        } else {\n            LOGGER.debug(\"Key file not provided\");\n        }\n\n        return new byte[]{};\n    }\n}\n\n'''\nThe error is caused by a change in the API of the dependency: plexus-sec-dispatcher 2.0->3.0.0. \nThe new library version includes the following relevant backward incompatible changes on API. \n(API changes format: lines starting with '--' denote removed members, '++' denote added ones, '~~' denote mutations with change kind) \n-- org.sonatype.plexus.components.sec.dispatcher.SecDispatcher\n\nThe error is triggered in the following specific lines in the previous code:\nimport org.sonatype.plexus.components.sec.dispatcher.SecDispatcher;\n    private SecDispatcher secDispatcher;\nwith the following error message:\n[ERROR] /sign-maven-plugin/src/main/java/org/simplify4u/plugins/sign/KeyInfoFactory.java:[37,53] package org.sonatype.plexus.components.sec.dispatcher does not exist\n[ERROR] /sign-maven-plugin/src/main/java/org/simplify4u/plugins/sign/KeyInfoFactory.java:[55,13] cannot find symbol  symbol:   class SecDispatcher\n  location: class org.simplify4u.plugins.sign.KeyInfoFactory\n\nPlease apply your reasoning and generate the fix following the system instruction.\n",
    "buggy_lines": "import org.sonatype.plexus.components.sec.dispatcher.SecDispatcher;\n    private SecDispatcher secDispatcher;",
    "error_message": "[ERROR] /sign-maven-plugin/src/main/java/org/simplify4u/plugins/sign/KeyInfoFactory.java:[37,53] package org.sonatype.plexus.components.sec.dispatcher does not exist\n[ERROR] /sign-maven-plugin/src/main/java/org/simplify4u/plugins/sign/KeyInfoFactory.java:[55,13] cannot find symbol  symbol:   class SecDispatcher\n  location: class org.simplify4u.plugins.sign.KeyInfoFactory",
    "api_diff": "-- org.sonatype.plexus.components.sec.dispatcher.SecDispatcher",
    "original_code": "/*\n * Copyright 2021 Slawomir Jaranowski\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.simplify4u.plugins.sign;\n\nimport java.io.File;\nimport java.math.BigInteger;\nimport java.nio.charset.StandardCharsets;\nimport java.nio.file.Files;\nimport java.util.Optional;\nimport javax.inject.Inject;\nimport javax.inject.Named;\nimport javax.inject.Singleton;\n\nimport io.vavr.control.Try;\nimport lombok.Builder;\nimport lombok.Value;\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.settings.Server;\nimport org.apache.maven.settings.Settings;\nimport org.simplify4u.plugins.sign.openpgp.PGPKeyInfo;\nimport org.simplify4u.plugins.sign.utils.Environment;\nimport org.simplify4u.plugins.sign.utils.FileUtil;\nimport org.sonatype.plexus.components.sec.dispatcher.SecDispatcher;\n\n/**\n * Service to build {@link PGPKeyInfo} object.\n */\n@Singleton\n@Named\n@Slf4j\npublic class KeyInfoFactory {\n\n    private static final String SIGN_KEY_ID_ENV = \"SIGN_KEY_ID\";\n    private static final String SIGN_KEY_ENV = \"SIGN_KEY\";\n    private static final String SIGN_KEY_PASS_ENV = \"SIGN_KEY_PASS\";\n\n    @Inject\n    private Environment environment;\n\n    @Inject\n    private SecDispatcher secDispatcher;\n\n    @Inject\n    private MavenSession mavenSession;\n\n    /**\n     * Value class for data needed to build key info.\n     */\n    @Value\n    @Builder\n    public static class KeyInfoRequest {\n\n        String serverId;\n        String id;\n        String pass;\n        File file;\n    }\n\n    /**\n     * Build {@link PGPKeyInfo}.\n     *\n     * @param keyInfoRequest input data for key\n     *\n     * @return a {@link PGPKeyInfo} with resolved data.\n     */\n    public PGPKeyInfo buildKeyInfo(KeyInfoRequest keyInfoRequest) {\n\n        final String id;\n        final String pass;\n        final File keyFile;\n\n        // serverId was provided - so all data will be read from settings\n        if (keyInfoRequest.getServerId() != null) {\n            Settings settings = mavenSession.getSettings();\n            Optional<Server> server = Optional.ofNullable(settings.getServer(keyInfoRequest.getServerId()));\n            if (server.isPresent()) {\n                LOGGER.debug(\"server id: {} found - read key info from settings.xml\", keyInfoRequest.getServerId());\n            } else {\n                LOGGER.debug(\"server id: {} not found in settings.xml\", keyInfoRequest.getServerId());\n            }\n            id = server.map(Server::getUsername).orElse(null);\n            pass = server.map(Server::getPassphrase).orElse(null);\n            keyFile = server.map(Server::getPrivateKey).map(File::new).orElse(null);\n        } else {\n            id = keyInfoRequest.getId();\n            pass = keyInfoRequest.getPass();\n            keyFile = keyInfoRequest.getFile();\n        }\n\n        return PGPKeyInfo.builder()\n                .id(resolveKeyId(id))\n                .pass(resolveKeyPass(pass))\n                .key(resolveKey(keyFile))\n                .build();\n    }\n\n    private Long resolveKeyId(String id) {\n        return Optional.ofNullable(environment.getEnv(SIGN_KEY_ID_ENV).orElse(id))\n                .map(KeyInfoFactory::parseKeyId)\n                .orElse(null);\n    }\n\n    private String resolveKeyPass(String pass) {\n        return Optional.ofNullable(environment.getEnv(SIGN_KEY_PASS_ENV).orElse(pass))\n                .map(this::decryptPass)\n                .orElse(null);\n    }\n\n    private byte[] resolveKey(File keyFile) {\n        return environment.getEnv(SIGN_KEY_ENV)\n                .map(String::trim)\n                .map(KeyInfoFactory::keyFromString)\n                .orElseGet(() -> keyFromFile(keyFile));\n    }\n\n    private String decryptPass(String pass) {\n        return Try.of(() -> secDispatcher.decrypt(pass))\n                .getOrElseThrow(e -> new SignMojoException(\"Invalid encrypted password: \" + e.getMessage()));\n    }\n\n    private static long parseKeyId(String key) {\n        return Try.of(() -> new BigInteger(key, 16))\n                .map(BigInteger::longValue)\n                .getOrElseThrow(e -> new SignMojoException(\"Invalid keyId: \" + e.getMessage()));\n    }\n\n    private static byte[] keyFromString(String key) {\n        return key.getBytes(StandardCharsets.US_ASCII);\n    }\n\n    private static byte[] keyFromFile(File keyFile) {\n\n        if (keyFile != null) {\n            File file = FileUtil.calculateWithUserHome(keyFile);\n\n            if (file.exists()) {\n                LOGGER.debug(\"Read key from file: {}\", file);\n                return Try.of(() -> Files.readAllBytes(file.toPath())).get();\n            } else {\n                LOGGER.debug(\"Key file: {} not exist\", keyFile);\n            }\n        } else {\n            LOGGER.debug(\"Key file not provided\");\n        }\n\n        return new byte[]{};\n    }\n}\n",
    "project": "sign-maven-plugin",
    "libraryName": "plexus-sec-dispatcher",
    "libraryGroupID": "org.codehaus.plexus",
    "newVersion": "3.0.0",
    "previousVersion": "2.0",
    "breakingCommit": "065dc3e56b588330508c8eaa8bba11e66b4d27c1"
}