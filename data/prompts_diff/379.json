{
    "absolute_path_to_file_in_container": "/lithium/src/main/java/com/wire/lithium/API.java",
    "errors": [
        {
            "line_number": 39,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[39,19] package javax.ws.rs does not exist",
            "additional_info": "",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "6da3ed5e-d447-5d33-aacc-c60d95db94ca"
        },
        {
            "line_number": 41,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[41,26] package javax.ws.rs.client does not exist",
            "additional_info": "",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "0fc8ca08-abdf-59d8-b054-7aa13ee356a8"
        },
        {
            "line_number": 42,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[42,26] package javax.ws.rs.client does not exist",
            "additional_info": "",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "0fc8ca08-abdf-59d8-b054-7aa13ee356a8"
        },
        {
            "line_number": 43,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[43,26] package javax.ws.rs.client does not exist",
            "additional_info": "",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "0fc8ca08-abdf-59d8-b054-7aa13ee356a8"
        },
        {
            "line_number": 44,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[44,1] package javax.ws.rs.core does not exist",
            "additional_info": "",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "7d67f287-4b1d-560e-8978-3bac0a889313"
        },
        {
            "line_number": 55,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[55,19] cannot find symbol",
            "additional_info": "  symbol:   class WebTarget\n  location: class com.wire.lithium.API",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "0b797576-31f5-5996-b915-156862f4d079"
        },
        {
            "line_number": 56,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[56,19] cannot find symbol",
            "additional_info": "  symbol:   class WebTarget\n  location: class com.wire.lithium.API",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "0b797576-31f5-5996-b915-156862f4d079"
        },
        {
            "line_number": 57,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[57,19] cannot find symbol",
            "additional_info": "  symbol:   class WebTarget\n  location: class com.wire.lithium.API",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "0b797576-31f5-5996-b915-156862f4d079"
        },
        {
            "line_number": 58,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[58,19] cannot find symbol",
            "additional_info": "  symbol:   class WebTarget\n  location: class com.wire.lithium.API",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "0b797576-31f5-5996-b915-156862f4d079"
        },
        {
            "line_number": 59,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[59,19] cannot find symbol",
            "additional_info": "  symbol:   class WebTarget\n  location: class com.wire.lithium.API",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "0b797576-31f5-5996-b915-156862f4d079"
        },
        {
            "line_number": 60,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[60,19] cannot find symbol",
            "additional_info": "  symbol:   class WebTarget\n  location: class com.wire.lithium.API",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "0b797576-31f5-5996-b915-156862f4d079"
        },
        {
            "line_number": 61,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[61,19] cannot find symbol",
            "additional_info": "  symbol:   class WebTarget\n  location: class com.wire.lithium.API",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "0b797576-31f5-5996-b915-156862f4d079"
        },
        {
            "line_number": 63,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[63,19] cannot find symbol",
            "additional_info": "  symbol:   class Client\n  location: class com.wire.lithium.API",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "5c13d9f2-0853-5b4f-9a47-85e70012546d"
        },
        {
            "line_number": 66,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[66,16] cannot find symbol",
            "additional_info": "  symbol:   class Client\n  location: class com.wire.lithium.API",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "5c13d9f2-0853-5b4f-9a47-85e70012546d"
        },
        {
            "line_number": 70,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[70,16] cannot find symbol",
            "additional_info": "  symbol:   class Client\n  location: class com.wire.lithium.API",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "5c13d9f2-0853-5b4f-9a47-85e70012546d"
        },
        {
            "line_number": 105,
            "message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[105,12] cannot find symbol",
            "additional_info": "  symbol:   class Response\n  location: class com.wire.lithium.API",
            "file_name": "API.java",
            "BCs": [],
            "Additions": [],
            "uid": "c21ea43b-a5c7-5eb7-b190-d3b6c34a172f"
        }
    ],
    "prompt": "\nThe following Java client code fails: \n'''java\n//\n// Wire\n// Copyright (C) 2016 Wire Swiss GmbH\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program. If not, see http://www.gnu.org/licenses/.\n//\n\npackage com.wire.lithium;\n\nimport com.fasterxml.jackson.annotation.JsonProperty;\nimport com.wire.lithium.models.NewBotResponseModel;\nimport com.wire.xenon.Const;\nimport com.wire.xenon.WireAPI;\nimport com.wire.xenon.assets.IAsset;\nimport com.wire.xenon.backend.models.Conversation;\nimport com.wire.xenon.backend.models.User;\nimport com.wire.xenon.exceptions.HttpException;\nimport com.wire.xenon.models.AssetKey;\nimport com.wire.xenon.models.otr.*;\nimport com.wire.xenon.tools.Logger;\nimport com.wire.xenon.tools.Util;\nimport org.glassfish.jersey.client.ClientProperties;\nimport org.glassfish.jersey.logging.LoggingFeature;\nimport org.glassfish.jersey.media.multipart.BodyPart;\nimport org.glassfish.jersey.media.multipart.MultiPart;\n\nimport javax.annotation.Nullable;\nimport javax.ws.rs.NotSupportedException;\nimport javax.ws.rs.client.Client;\nimport javax.ws.rs.client.Entity;\nimport javax.ws.rs.client.Invocation;\nimport javax.ws.rs.client.WebTarget;\nimport javax.ws.rs.core.*;\nimport java.io.ByteArrayOutputStream;\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.security.NoSuchAlgorithmException;\nimport java.util.*;\nimport java.util.logging.Level;\n\npublic class API implements WireAPI {\n    private final String wireHost;\n\n    private final WebTarget messages;\n    private final WebTarget assets;\n    private final WebTarget client;\n    private final WebTarget prekeys;\n    private final WebTarget users;\n    private final WebTarget conversation;\n    private final WebTarget bot;\n\n    private final Client httpClient;\n    private final String token;\n\n    public API(Client httpClient, String token) {\n        this(httpClient, token, deriveHost());\n    }\n\n    public API(Client httpClient, String token, String wireHost) {\n        this.httpClient = httpClient;\n        this.token = token;\n\n        this.wireHost = wireHost;\n\n        bot = httpClient\n                .target(wireHost)\n                .path(\"bot\");\n        messages = bot\n                .path(\"messages\");\n        assets = bot\n                .path(\"assets\");\n        users = bot\n                .path(\"users\");\n        conversation = bot\n                .path(\"conversation\");\n        client = bot\n                .path(\"client\")\n                .path(\"prekeys\");\n        prekeys = users\n                .path(\"prekeys\");\n\n        if (Logger.getLevel() == Level.FINE) {\n            Feature feature = new LoggingFeature(Logger.getLOGGER(), Level.FINE, null, null);\n            assets.register(feature);\n            users.register(feature);\n        }\n    }\n\n    private static String deriveHost() {\n        String host = System.getProperty(Const.WIRE_BOTS_SDK_API, System.getenv(\"WIRE_API_HOST\"));\n        return host != null ? host : \"https://prod-nginz-https.wire.com\";\n    }\n\n    public Response status() {\n        return httpClient.target(wireHost)\n                .path(\"status\")\n                .request()\n                .get();\n    }\n\n    public String getWireHost() {\n        return this.wireHost;\n    }\n\n    /**\n     * This method sends the OtrMessage to BE. Message must contain cipher for all participants and all their clients.\n     *\n     * @param msg           OtrMessage object containing ciphers for all clients\n     * @param ignoreMissing If TRUE ignore missing clients and deliver the message to available clients\n     * @return List of missing devices in case of fail or an empty list.\n     * @throws HttpException Http Exception is thrown when status {@literal >}= 400\n     */\n    @Override\n    public Devices sendMessage(OtrMessage msg, Object... ignoreMissing) throws HttpException {\n        Response response = messages\n                .queryParam(\"ignore_missing\", ignoreMissing)\n                .request(MediaType.APPLICATION_JSON)\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .post(Entity.entity(msg, MediaType.APPLICATION_JSON));\n\n        int statusCode = response.getStatus();\n        if (statusCode == 412) {\n            // This message was not sent due to missing clients. Parse those missing clients so the caller can add them\n            return response.readEntity(Devices.class);\n        }\n\n        if (statusCode >= 400) {\n            throw new HttpException(response.readEntity(String.class), statusCode);\n        }\n\n        return response.readEntity(Devices.class);\n    }\n\n    @Override\n    public Devices sendPartialMessage(OtrMessage msg, UUID userId) throws HttpException {\n        Response response = messages\n                .queryParam(\"report_missing\", userId)\n                .request(MediaType.APPLICATION_JSON)\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .post(Entity.entity(msg, MediaType.APPLICATION_JSON));\n\n        int statusCode = response.getStatus();\n        if (statusCode == 412) {\n            // This message was not sent due to missing clients. Parse those missing clients so the caller can add them\n            return response.readEntity(Devices.class);\n        }\n\n        if (statusCode >= 400) {\n            throw new HttpException(response.readEntity(String.class), statusCode);\n        }\n\n        return response.readEntity(Devices.class);\n    }\n\n    @Override\n    public Collection<User> getUsers(Collection<UUID> ids) {\n        return users\n                .queryParam(\"ids\", ids.toArray())\n                .request(MediaType.APPLICATION_JSON)\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .get(new GenericType<ArrayList<User>>() {\n                });\n    }\n\n    @Override\n    public User getSelf() {\n        return bot\n                .path(\"self\")\n                .request(MediaType.APPLICATION_JSON)\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .get(User.class);\n    }\n\n    @Override\n    public Conversation getConversation() {\n        return conversation\n                .request()\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .accept(MediaType.APPLICATION_JSON)\n                .get(Conversation.class);\n    }\n\n    @Override\n    public PreKeys getPreKeys(Missing missing) {\n        return prekeys\n                .request(MediaType.APPLICATION_JSON)\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .accept(MediaType.APPLICATION_JSON)\n                .post(Entity.entity(missing, MediaType.APPLICATION_JSON), PreKeys.class);\n    }\n\n    @Override\n    public ArrayList<Integer> getAvailablePrekeys(@Nullable String clientId) {\n        return client\n                .request()\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .accept(MediaType.APPLICATION_JSON)\n                .get(new GenericType<>() {\n                });\n    }\n\n    @Override\n    public void uploadPreKeys(ArrayList<PreKey> preKeys) throws IOException {\n        NewBotResponseModel model = new NewBotResponseModel();\n        model.preKeys = preKeys;\n\n        Response res = client\n                .request(MediaType.APPLICATION_JSON)\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .accept(MediaType.APPLICATION_JSON)\n                .post(Entity.entity(model, MediaType.APPLICATION_JSON));\n\n        int statusCode = res.getStatus();\n        if (statusCode >= 400) {\n            throw new IOException(res.readEntity(String.class));\n        }\n    }\n\n    @Override\n    public AssetKey uploadAsset(IAsset asset) throws Exception {\n        StringBuilder sb = new StringBuilder();\n\n        // Part 1\n        String strMetadata = String.format(\"{\\\"public\\\": %s, \\\"retention\\\": \\\"%s\\\"}\",\n                asset.isPublic(),\n                asset.getRetention());\n        sb.append(\"--frontier\\r\\n\");\n        sb.append(\"Content-Type: application/json; charset=utf-8\\r\\n\");\n        sb.append(\"Content-Length: \")\n                .append(strMetadata.length())\n                .append(\"\\r\\n\\r\\n\");\n        sb.append(strMetadata)\n                .append(\"\\r\\n\");\n\n        // Part 2\n        sb.append(\"--frontier\\r\\n\");\n        sb.append(\"Content-Type: \")\n                .append(asset.getMimeType())\n                .append(\"\\r\\n\");\n        sb.append(\"Content-Length: \")\n                .append(asset.getEncryptedData().length)\n                .append(\"\\r\\n\");\n        sb.append(\"Content-MD5: \")\n                .append(Util.calcMd5(asset.getEncryptedData()))\n                .append(\"\\r\\n\\r\\n\");\n\n        // Complete\n        ByteArrayOutputStream os = new ByteArrayOutputStream();\n        os.write(sb.toString().getBytes(StandardCharsets.UTF_8));\n        os.write(asset.getEncryptedData());\n        os.write(\"\\r\\n--frontier--\\r\\n\".getBytes(StandardCharsets.UTF_8));\n\n        Response response = assets\n                .request(MediaType.APPLICATION_JSON_TYPE)\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .post(Entity.entity(os.toByteArray(), \"multipart/mixed; boundary=frontier\"));\n\n        if (response.getStatus() >= 400) {\n            throw new HttpException(response.readEntity(String.class), response.getStatus());\n        }\n\n        return response.readEntity(AssetKey.class);\n    }\n\n    private MultiPart getMultiPart(IAsset asset) throws NoSuchAlgorithmException {\n        MetaData metaData = new MetaData();\n        metaData.retention = asset.getRetention();\n        metaData.scope = asset.isPublic();\n\n        BodyPart bodyPart1 = new BodyPart(metaData, MediaType.APPLICATION_JSON_TYPE);\n        BodyPart bodyPart2 = new BodyPart().entity(asset.getEncryptedData());\n\n        MultivaluedMap<String, String> headers = bodyPart2.getHeaders();\n        headers.add(\"Content-Type\", asset.getMimeType());\n        headers.add(\"Content-MD5\", Util.calcMd5(asset.getEncryptedData()));\n\n        return new MultiPart()\n                .bodyPart(bodyPart1)\n                .bodyPart(bodyPart2);\n    }\n\n    @Override\n    public byte[] downloadAsset(String assetId, String assetToken) throws HttpException {\n        Invocation.Builder req = assets\n                .path(assetId)\n                .request()\n                .property(ClientProperties.FOLLOW_REDIRECTS, Boolean.FALSE)\n                .header(HttpHeaders.AUTHORIZATION, bearer());\n\n        if (assetToken != null && !assetToken.isBlank())\n            req.header(\"Asset-Token\", assetToken);\n\n        Response response = req.get();\n\n        if (response.getStatus() >= 400) {\n            throw new HttpException(response.readEntity(String.class), response.getStatus());\n        }\n\n        final String location = response.getHeaderString(HttpHeaders.LOCATION);\n        response.close();\n\n        response = httpClient\n                .target(location)\n                .request()\n                .get();\n\n        if (response.getStatus() >= 400) {\n            throw new HttpException(response.readEntity(String.class), response.getStatus());\n        }\n\n        return response.readEntity(byte[].class);\n    }\n\n    @Override\n    public boolean deleteConversation(UUID teamId) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public User addService(UUID serviceId, UUID providerId) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public User addParticipants(UUID... userIds) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public Conversation createConversation(String name, UUID teamId, List<UUID> users) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public Conversation createOne2One(UUID teamId, UUID userId) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public void leaveConversation(UUID user) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public User getUser(UUID userId) {\n        return getUsers(Collections.singletonList(userId))\n                .stream()\n                .findFirst()\n                .orElse(null);\n    }\n\n    @Override\n    public UUID getUserId(String handle) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public boolean hasDevice(UUID userId, String clientId) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public UUID getTeam() {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public Collection<UUID> getTeamMembers(UUID teamId) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public void acceptConnection(UUID user) {\n        throw new NotSupportedException();\n    }\n\n    private String bearer() {\n        return String.format(\"Bearer %s\", token);\n    }\n\n    public static class MetaData {\n        @JsonProperty(\"public\")\n        public boolean scope;\n        @JsonProperty\n        public String retention;\n    }\n}\n\n'''\nThe error is caused by a change in the API of the dependency: dropwizard-core 2.1.5->4.0.0. \nThe new library version includes the following relevant backward incompatible changes on API. \n(API changes format: lines starting with '--' denote removed members, '++' denote added ones, '~~' denote mutations with change kind) \n-- io.dropwizard.Application\n-- io.dropwizard.setup.Environment\n-- io.dropwizard.setup.Bootstrap\n-- io.dropwizard.Configuration\n++ public Configuration io.dropwizard.core.Configuration()\n++ public Environment io.dropwizard.core.setup.Environment(java.lang.String,com.fasterxml.jackson.databind.ObjectMapper,jakarta.validation.ValidatorFactory,com.codahale.metrics.MetricRegistry,java.lang.ClassLoader,com.codahale.metrics.health.HealthCheckRegistry,io.dropwizard.core.Configuration)\n++ protected Application io.dropwizard.core.Application()\n++ public Bootstrap io.dropwizard.core.setup.Bootstrap(io.dropwizard.core.Application)\n++ public Environment io.dropwizard.core.setup.Environment(java.lang.String)\n\nThe error is triggered in the following specific lines in the previous code:\nimport javax.ws.rs.NotSupportedException;\nimport javax.ws.rs.client.Entity;\nimport javax.ws.rs.client.Invocation;\nimport javax.ws.rs.client.WebTarget;\nimport javax.ws.rs.core.*;\n    private final WebTarget messages;\n    private final WebTarget assets;\n    private final WebTarget client;\n    private final WebTarget prekeys;\n    private final WebTarget users;\n    private final WebTarget conversation;\n    private final WebTarget bot;\n    private final Client httpClient;\n    public API(Client httpClient, String token) {\n    public API(Client httpClient, String token, String wireHost) {\n    public Response status() {\nwith the following error message:\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[39,19] package javax.ws.rs does not exist\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[41,26] package javax.ws.rs.client does not exist\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[42,26] package javax.ws.rs.client does not exist\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[43,26] package javax.ws.rs.client does not exist\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[44,1] package javax.ws.rs.core does not exist\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[55,19] cannot find symbol  symbol:   class WebTarget\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[56,19] cannot find symbol  symbol:   class WebTarget\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[57,19] cannot find symbol  symbol:   class WebTarget\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[58,19] cannot find symbol  symbol:   class WebTarget\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[59,19] cannot find symbol  symbol:   class WebTarget\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[60,19] cannot find symbol  symbol:   class WebTarget\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[61,19] cannot find symbol  symbol:   class WebTarget\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[63,19] cannot find symbol  symbol:   class Client\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[66,16] cannot find symbol  symbol:   class Client\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[70,16] cannot find symbol  symbol:   class Client\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[105,12] cannot find symbol  symbol:   class Response\n  location: class com.wire.lithium.API\n\nPlease apply your reasoning and generate the fix following the system instruction.\n",
    "buggy_lines": "import javax.ws.rs.NotSupportedException;\nimport javax.ws.rs.client.Entity;\nimport javax.ws.rs.client.Invocation;\nimport javax.ws.rs.client.WebTarget;\nimport javax.ws.rs.core.*;\n    private final WebTarget messages;\n    private final WebTarget assets;\n    private final WebTarget client;\n    private final WebTarget prekeys;\n    private final WebTarget users;\n    private final WebTarget conversation;\n    private final WebTarget bot;\n    private final Client httpClient;\n    public API(Client httpClient, String token) {\n    public API(Client httpClient, String token, String wireHost) {\n    public Response status() {",
    "error_message": "[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[39,19] package javax.ws.rs does not exist\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[41,26] package javax.ws.rs.client does not exist\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[42,26] package javax.ws.rs.client does not exist\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[43,26] package javax.ws.rs.client does not exist\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[44,1] package javax.ws.rs.core does not exist\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[55,19] cannot find symbol  symbol:   class WebTarget\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[56,19] cannot find symbol  symbol:   class WebTarget\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[57,19] cannot find symbol  symbol:   class WebTarget\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[58,19] cannot find symbol  symbol:   class WebTarget\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[59,19] cannot find symbol  symbol:   class WebTarget\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[60,19] cannot find symbol  symbol:   class WebTarget\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[61,19] cannot find symbol  symbol:   class WebTarget\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[63,19] cannot find symbol  symbol:   class Client\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[66,16] cannot find symbol  symbol:   class Client\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[70,16] cannot find symbol  symbol:   class Client\n  location: class com.wire.lithium.API\n[ERROR] /lithium/src/main/java/com/wire/lithium/API.java:[105,12] cannot find symbol  symbol:   class Response\n  location: class com.wire.lithium.API",
    "api_diff": "-- io.dropwizard.Application\n-- io.dropwizard.setup.Environment\n-- io.dropwizard.setup.Bootstrap\n-- io.dropwizard.Configuration\n++ public Configuration io.dropwizard.core.Configuration()\n++ public Environment io.dropwizard.core.setup.Environment(java.lang.String,com.fasterxml.jackson.databind.ObjectMapper,jakarta.validation.ValidatorFactory,com.codahale.metrics.MetricRegistry,java.lang.ClassLoader,com.codahale.metrics.health.HealthCheckRegistry,io.dropwizard.core.Configuration)\n++ protected Application io.dropwizard.core.Application()\n++ public Bootstrap io.dropwizard.core.setup.Bootstrap(io.dropwizard.core.Application)\n++ public Environment io.dropwizard.core.setup.Environment(java.lang.String)",
    "original_code": "//\n// Wire\n// Copyright (C) 2016 Wire Swiss GmbH\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program. If not, see http://www.gnu.org/licenses/.\n//\n\npackage com.wire.lithium;\n\nimport com.fasterxml.jackson.annotation.JsonProperty;\nimport com.wire.lithium.models.NewBotResponseModel;\nimport com.wire.xenon.Const;\nimport com.wire.xenon.WireAPI;\nimport com.wire.xenon.assets.IAsset;\nimport com.wire.xenon.backend.models.Conversation;\nimport com.wire.xenon.backend.models.User;\nimport com.wire.xenon.exceptions.HttpException;\nimport com.wire.xenon.models.AssetKey;\nimport com.wire.xenon.models.otr.*;\nimport com.wire.xenon.tools.Logger;\nimport com.wire.xenon.tools.Util;\nimport org.glassfish.jersey.client.ClientProperties;\nimport org.glassfish.jersey.logging.LoggingFeature;\nimport org.glassfish.jersey.media.multipart.BodyPart;\nimport org.glassfish.jersey.media.multipart.MultiPart;\n\nimport javax.annotation.Nullable;\nimport javax.ws.rs.NotSupportedException;\nimport javax.ws.rs.client.Client;\nimport javax.ws.rs.client.Entity;\nimport javax.ws.rs.client.Invocation;\nimport javax.ws.rs.client.WebTarget;\nimport javax.ws.rs.core.*;\nimport java.io.ByteArrayOutputStream;\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.security.NoSuchAlgorithmException;\nimport java.util.*;\nimport java.util.logging.Level;\n\npublic class API implements WireAPI {\n    private final String wireHost;\n\n    private final WebTarget messages;\n    private final WebTarget assets;\n    private final WebTarget client;\n    private final WebTarget prekeys;\n    private final WebTarget users;\n    private final WebTarget conversation;\n    private final WebTarget bot;\n\n    private final Client httpClient;\n    private final String token;\n\n    public API(Client httpClient, String token) {\n        this(httpClient, token, deriveHost());\n    }\n\n    public API(Client httpClient, String token, String wireHost) {\n        this.httpClient = httpClient;\n        this.token = token;\n\n        this.wireHost = wireHost;\n\n        bot = httpClient\n                .target(wireHost)\n                .path(\"bot\");\n        messages = bot\n                .path(\"messages\");\n        assets = bot\n                .path(\"assets\");\n        users = bot\n                .path(\"users\");\n        conversation = bot\n                .path(\"conversation\");\n        client = bot\n                .path(\"client\")\n                .path(\"prekeys\");\n        prekeys = users\n                .path(\"prekeys\");\n\n        if (Logger.getLevel() == Level.FINE) {\n            Feature feature = new LoggingFeature(Logger.getLOGGER(), Level.FINE, null, null);\n            assets.register(feature);\n            users.register(feature);\n        }\n    }\n\n    private static String deriveHost() {\n        String host = System.getProperty(Const.WIRE_BOTS_SDK_API, System.getenv(\"WIRE_API_HOST\"));\n        return host != null ? host : \"https://prod-nginz-https.wire.com\";\n    }\n\n    public Response status() {\n        return httpClient.target(wireHost)\n                .path(\"status\")\n                .request()\n                .get();\n    }\n\n    public String getWireHost() {\n        return this.wireHost;\n    }\n\n    /**\n     * This method sends the OtrMessage to BE. Message must contain cipher for all participants and all their clients.\n     *\n     * @param msg           OtrMessage object containing ciphers for all clients\n     * @param ignoreMissing If TRUE ignore missing clients and deliver the message to available clients\n     * @return List of missing devices in case of fail or an empty list.\n     * @throws HttpException Http Exception is thrown when status {@literal >}= 400\n     */\n    @Override\n    public Devices sendMessage(OtrMessage msg, Object... ignoreMissing) throws HttpException {\n        Response response = messages\n                .queryParam(\"ignore_missing\", ignoreMissing)\n                .request(MediaType.APPLICATION_JSON)\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .post(Entity.entity(msg, MediaType.APPLICATION_JSON));\n\n        int statusCode = response.getStatus();\n        if (statusCode == 412) {\n            // This message was not sent due to missing clients. Parse those missing clients so the caller can add them\n            return response.readEntity(Devices.class);\n        }\n\n        if (statusCode >= 400) {\n            throw new HttpException(response.readEntity(String.class), statusCode);\n        }\n\n        return response.readEntity(Devices.class);\n    }\n\n    @Override\n    public Devices sendPartialMessage(OtrMessage msg, UUID userId) throws HttpException {\n        Response response = messages\n                .queryParam(\"report_missing\", userId)\n                .request(MediaType.APPLICATION_JSON)\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .post(Entity.entity(msg, MediaType.APPLICATION_JSON));\n\n        int statusCode = response.getStatus();\n        if (statusCode == 412) {\n            // This message was not sent due to missing clients. Parse those missing clients so the caller can add them\n            return response.readEntity(Devices.class);\n        }\n\n        if (statusCode >= 400) {\n            throw new HttpException(response.readEntity(String.class), statusCode);\n        }\n\n        return response.readEntity(Devices.class);\n    }\n\n    @Override\n    public Collection<User> getUsers(Collection<UUID> ids) {\n        return users\n                .queryParam(\"ids\", ids.toArray())\n                .request(MediaType.APPLICATION_JSON)\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .get(new GenericType<ArrayList<User>>() {\n                });\n    }\n\n    @Override\n    public User getSelf() {\n        return bot\n                .path(\"self\")\n                .request(MediaType.APPLICATION_JSON)\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .get(User.class);\n    }\n\n    @Override\n    public Conversation getConversation() {\n        return conversation\n                .request()\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .accept(MediaType.APPLICATION_JSON)\n                .get(Conversation.class);\n    }\n\n    @Override\n    public PreKeys getPreKeys(Missing missing) {\n        return prekeys\n                .request(MediaType.APPLICATION_JSON)\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .accept(MediaType.APPLICATION_JSON)\n                .post(Entity.entity(missing, MediaType.APPLICATION_JSON), PreKeys.class);\n    }\n\n    @Override\n    public ArrayList<Integer> getAvailablePrekeys(@Nullable String clientId) {\n        return client\n                .request()\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .accept(MediaType.APPLICATION_JSON)\n                .get(new GenericType<>() {\n                });\n    }\n\n    @Override\n    public void uploadPreKeys(ArrayList<PreKey> preKeys) throws IOException {\n        NewBotResponseModel model = new NewBotResponseModel();\n        model.preKeys = preKeys;\n\n        Response res = client\n                .request(MediaType.APPLICATION_JSON)\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .accept(MediaType.APPLICATION_JSON)\n                .post(Entity.entity(model, MediaType.APPLICATION_JSON));\n\n        int statusCode = res.getStatus();\n        if (statusCode >= 400) {\n            throw new IOException(res.readEntity(String.class));\n        }\n    }\n\n    @Override\n    public AssetKey uploadAsset(IAsset asset) throws Exception {\n        StringBuilder sb = new StringBuilder();\n\n        // Part 1\n        String strMetadata = String.format(\"{\\\"public\\\": %s, \\\"retention\\\": \\\"%s\\\"}\",\n                asset.isPublic(),\n                asset.getRetention());\n        sb.append(\"--frontier\\r\\n\");\n        sb.append(\"Content-Type: application/json; charset=utf-8\\r\\n\");\n        sb.append(\"Content-Length: \")\n                .append(strMetadata.length())\n                .append(\"\\r\\n\\r\\n\");\n        sb.append(strMetadata)\n                .append(\"\\r\\n\");\n\n        // Part 2\n        sb.append(\"--frontier\\r\\n\");\n        sb.append(\"Content-Type: \")\n                .append(asset.getMimeType())\n                .append(\"\\r\\n\");\n        sb.append(\"Content-Length: \")\n                .append(asset.getEncryptedData().length)\n                .append(\"\\r\\n\");\n        sb.append(\"Content-MD5: \")\n                .append(Util.calcMd5(asset.getEncryptedData()))\n                .append(\"\\r\\n\\r\\n\");\n\n        // Complete\n        ByteArrayOutputStream os = new ByteArrayOutputStream();\n        os.write(sb.toString().getBytes(StandardCharsets.UTF_8));\n        os.write(asset.getEncryptedData());\n        os.write(\"\\r\\n--frontier--\\r\\n\".getBytes(StandardCharsets.UTF_8));\n\n        Response response = assets\n                .request(MediaType.APPLICATION_JSON_TYPE)\n                .header(HttpHeaders.AUTHORIZATION, bearer())\n                .post(Entity.entity(os.toByteArray(), \"multipart/mixed; boundary=frontier\"));\n\n        if (response.getStatus() >= 400) {\n            throw new HttpException(response.readEntity(String.class), response.getStatus());\n        }\n\n        return response.readEntity(AssetKey.class);\n    }\n\n    private MultiPart getMultiPart(IAsset asset) throws NoSuchAlgorithmException {\n        MetaData metaData = new MetaData();\n        metaData.retention = asset.getRetention();\n        metaData.scope = asset.isPublic();\n\n        BodyPart bodyPart1 = new BodyPart(metaData, MediaType.APPLICATION_JSON_TYPE);\n        BodyPart bodyPart2 = new BodyPart().entity(asset.getEncryptedData());\n\n        MultivaluedMap<String, String> headers = bodyPart2.getHeaders();\n        headers.add(\"Content-Type\", asset.getMimeType());\n        headers.add(\"Content-MD5\", Util.calcMd5(asset.getEncryptedData()));\n\n        return new MultiPart()\n                .bodyPart(bodyPart1)\n                .bodyPart(bodyPart2);\n    }\n\n    @Override\n    public byte[] downloadAsset(String assetId, String assetToken) throws HttpException {\n        Invocation.Builder req = assets\n                .path(assetId)\n                .request()\n                .property(ClientProperties.FOLLOW_REDIRECTS, Boolean.FALSE)\n                .header(HttpHeaders.AUTHORIZATION, bearer());\n\n        if (assetToken != null && !assetToken.isBlank())\n            req.header(\"Asset-Token\", assetToken);\n\n        Response response = req.get();\n\n        if (response.getStatus() >= 400) {\n            throw new HttpException(response.readEntity(String.class), response.getStatus());\n        }\n\n        final String location = response.getHeaderString(HttpHeaders.LOCATION);\n        response.close();\n\n        response = httpClient\n                .target(location)\n                .request()\n                .get();\n\n        if (response.getStatus() >= 400) {\n            throw new HttpException(response.readEntity(String.class), response.getStatus());\n        }\n\n        return response.readEntity(byte[].class);\n    }\n\n    @Override\n    public boolean deleteConversation(UUID teamId) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public User addService(UUID serviceId, UUID providerId) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public User addParticipants(UUID... userIds) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public Conversation createConversation(String name, UUID teamId, List<UUID> users) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public Conversation createOne2One(UUID teamId, UUID userId) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public void leaveConversation(UUID user) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public User getUser(UUID userId) {\n        return getUsers(Collections.singletonList(userId))\n                .stream()\n                .findFirst()\n                .orElse(null);\n    }\n\n    @Override\n    public UUID getUserId(String handle) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public boolean hasDevice(UUID userId, String clientId) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public UUID getTeam() {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public Collection<UUID> getTeamMembers(UUID teamId) {\n        throw new NotSupportedException();\n    }\n\n    @Override\n    public void acceptConnection(UUID user) {\n        throw new NotSupportedException();\n    }\n\n    private String bearer() {\n        return String.format(\"Bearer %s\", token);\n    }\n\n    public static class MetaData {\n        @JsonProperty(\"public\")\n        public boolean scope;\n        @JsonProperty\n        public String retention;\n    }\n}\n",
    "project": "lithium",
    "libraryName": "dropwizard-core",
    "libraryGroupID": "io.dropwizard",
    "newVersion": "4.0.0",
    "previousVersion": "2.1.5",
    "breakingCommit": "686ea4e18114ac180e35ca1c07e1f2e6dfbffbe0"
}