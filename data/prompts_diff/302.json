{
    "absolute_path_to_file_in_container": "/singer/singer/src/main/java/com/pinterest/singer/utils/SimpleThriftLogger.java",
    "errors": [
        {
            "line_number": 24,
            "message": "[ERROR] /singer/singer/src/main/java/com/pinterest/singer/utils/SimpleThriftLogger.java:[24,35] cannot find symbol",
            "additional_info": "  symbol:   class TFramedTransport\n  location: package org.apache.thrift.transport",
            "file_name": "SimpleThriftLogger.java",
            "BCs": [
                {
                    "element": "org.apache.thrift.transport.TFramedTransport",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [
                "++ public null org.apache.thrift.transport.layered.TFramedTransport",
                "++ public null org.apache.thrift.transport.layered.TFramedTransport",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport,int)",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport,int)",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport)",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport)"
            ],
            "uid": "d9a0fe00-8b13-5579-8f6d-d62709931ddb"
        },
        {
            "line_number": 45,
            "message": "[ERROR] /singer/singer/src/main/java/com/pinterest/singer/utils/SimpleThriftLogger.java:[45,65] cannot find symbol",
            "additional_info": "  symbol:   class TFramedTransport\n  location: class com.pinterest.singer.utils.SimpleThriftLogger<T>",
            "file_name": "SimpleThriftLogger.java",
            "BCs": [
                {
                    "element": "org.apache.thrift.transport.TFramedTransport",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [
                "++ public null org.apache.thrift.transport.layered.TFramedTransport",
                "++ public null org.apache.thrift.transport.layered.TFramedTransport",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport,int)",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport,int)",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport)",
                "++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport)"
            ],
            "uid": "80f005a7-9118-591f-afca-4cbfe2985601"
        }
    ],
    "prompt": "\nThe following Java client code fails: \n'''java\n/**\n * Copyright 2019 Pinterest, Inc.\n * \n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * \n *    http://www.apache.org/licenses/LICENSE-2.0\n * \n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.pinterest.singer.utils;\n\nimport com.pinterest.singer.thrift.LogFile;\n\nimport org.apache.commons.io.FileUtils;\nimport org.apache.thrift.TBase;\nimport org.apache.thrift.protocol.TBinaryProtocol;\nimport org.apache.thrift.protocol.TProtocol;\nimport org.apache.thrift.transport.TFramedTransport;\nimport org.apache.thrift.transport.TIOStreamTransport;\nimport org.apache.thrift.transport.TTransport;\nimport org.apache.thrift.transport.TTransportException;\n\nimport java.io.BufferedOutputStream;\nimport java.io.Closeable;\nimport java.io.File;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.nio.file.FileSystems;\n\n/**\n * Thrift Logger which is used to log thrift log messages into a log file.\n *\n * This class is used by unit test and ThriftLogGenerator to write log messages to thrift log\n * file. It provides APIs for client to control the flush behavior and log file rotation.\n */\n@SuppressWarnings(\"rawtypes\")\npublic final class SimpleThriftLogger<T extends TBase> implements Closeable {\n\n  private static final class ByteOffsetTFramedTransport extends TFramedTransport {\n\n    private long byteOffset;\n\n    public ByteOffsetTFramedTransport(TTransport transport) {\n      super(transport);\n      byteOffset = 0;\n    }\n\n    @Override\n    public void write(byte[] buf, int off, int len) throws TTransportException {\n      super.write(buf, off, len);\n      byteOffset += len;\n    }\n\n    @Override\n    public void flush() throws TTransportException {\n      super.flush();\n      // Add 4 bytes for the frame size.\n      byteOffset += 4;\n    }\n\n    public long getByteOffset() {\n      return byteOffset;\n    }\n  }\n\n  private final String fileName;\n\n  private BufferedOutputStream bufferedOutputStream;\n  private ByteOffsetTFramedTransport transport;\n  private TProtocol protocol;\n\n  public SimpleThriftLogger(String filename) throws Exception {\n    this.fileName = filename;\n    bufferedOutputStream = new BufferedOutputStream(new FileOutputStream(fileName, true));\n    transport = new ByteOffsetTFramedTransport(new TIOStreamTransport(bufferedOutputStream));\n    protocol = new TBinaryProtocol(transport);\n  }\n\n  /**\n   * Write a thrift message to log file.\n   * @param message to be written\n   * @throws Exception on write error.\n   */\n  public void logThrift(T message) throws Exception {\n    message.write(protocol);\n    // Flush to make sure one message per frame.\n    transport.flush();\n  }\n\n  /**\n   * Simple implementation of log file rotation.\n   * @throws java.io.IOException\n   */\n  public void rotate() throws IOException {\n    close();\n\n    int i = 0;\n    while (new File(String.format(\"%s.%d\", fileName, ++i)).exists()) {\n      ;\n    }\n\n    for (int j = i - 1; j >= 1; --j) {\n      FileUtils.moveFile(\n          new File(String.format(\"%s.%d\", fileName, j)),\n          new File(String.format(\"%s.%d\", fileName, j + 1)));\n    }\n    FileUtils.moveFile(new File(fileName), new File(fileName + \".1\"));\n    bufferedOutputStream = new BufferedOutputStream(new FileOutputStream(fileName, true));\n    transport = new ByteOffsetTFramedTransport(new TIOStreamTransport(bufferedOutputStream));\n    protocol = new TBinaryProtocol(transport);\n  }\n\n  public void flush() throws IOException {\n    bufferedOutputStream.flush();\n  }\n\n  public LogFile getLogFile() throws IOException {\n    long inode = SingerUtils.getFileInode(FileSystems.getDefault().getPath(fileName));\n    return new LogFile(inode);\n  }\n\n  public long getByteOffset() {\n    return transport.getByteOffset();\n  }\n\n  public void close() throws IOException {\n    transport.close();\n  }\n}\n\n'''\nThe error is caused by a change in the API of the dependency: libthrift 0.12.0->0.16.0. \nThe new library version includes the following relevant backward incompatible changes on API. \n(API changes format: lines starting with '--' denote removed members, '++' denote added ones, '~~' denote mutations with change kind) \n-- org.apache.thrift.transport.TFramedTransport\n++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport)\n++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport,int)\n++ public null org.apache.thrift.transport.layered.TFramedTransport\n\nThe error is triggered in the following specific lines in the previous code:\nimport org.apache.thrift.transport.TFramedTransport;\n  private static final class ByteOffsetTFramedTransport extends TFramedTransport {\nwith the following error message:\n[ERROR] /singer/singer/src/main/java/com/pinterest/singer/utils/SimpleThriftLogger.java:[24,35] cannot find symbol  symbol:   class TFramedTransport\n  location: package org.apache.thrift.transport\n[ERROR] /singer/singer/src/main/java/com/pinterest/singer/utils/SimpleThriftLogger.java:[45,65] cannot find symbol  symbol:   class TFramedTransport\n  location: class com.pinterest.singer.utils.SimpleThriftLogger<T>\n\nPlease apply your reasoning and generate the fix following the system instruction.\n",
    "buggy_lines": "import org.apache.thrift.transport.TFramedTransport;\n  private static final class ByteOffsetTFramedTransport extends TFramedTransport {",
    "error_message": "[ERROR] /singer/singer/src/main/java/com/pinterest/singer/utils/SimpleThriftLogger.java:[24,35] cannot find symbol  symbol:   class TFramedTransport\n  location: package org.apache.thrift.transport\n[ERROR] /singer/singer/src/main/java/com/pinterest/singer/utils/SimpleThriftLogger.java:[45,65] cannot find symbol  symbol:   class TFramedTransport\n  location: class com.pinterest.singer.utils.SimpleThriftLogger<T>",
    "api_diff": "-- org.apache.thrift.transport.TFramedTransport\n++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport)\n++ public TFramedTransport org.apache.thrift.transport.layered.TFramedTransport(org.apache.thrift.transport.TTransport,int)\n++ public null org.apache.thrift.transport.layered.TFramedTransport",
    "original_code": "/**\n * Copyright 2019 Pinterest, Inc.\n * \n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * \n *    http://www.apache.org/licenses/LICENSE-2.0\n * \n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.pinterest.singer.utils;\n\nimport com.pinterest.singer.thrift.LogFile;\n\nimport org.apache.commons.io.FileUtils;\nimport org.apache.thrift.TBase;\nimport org.apache.thrift.protocol.TBinaryProtocol;\nimport org.apache.thrift.protocol.TProtocol;\nimport org.apache.thrift.transport.TFramedTransport;\nimport org.apache.thrift.transport.TIOStreamTransport;\nimport org.apache.thrift.transport.TTransport;\nimport org.apache.thrift.transport.TTransportException;\n\nimport java.io.BufferedOutputStream;\nimport java.io.Closeable;\nimport java.io.File;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.nio.file.FileSystems;\n\n/**\n * Thrift Logger which is used to log thrift log messages into a log file.\n *\n * This class is used by unit test and ThriftLogGenerator to write log messages to thrift log\n * file. It provides APIs for client to control the flush behavior and log file rotation.\n */\n@SuppressWarnings(\"rawtypes\")\npublic final class SimpleThriftLogger<T extends TBase> implements Closeable {\n\n  private static final class ByteOffsetTFramedTransport extends TFramedTransport {\n\n    private long byteOffset;\n\n    public ByteOffsetTFramedTransport(TTransport transport) {\n      super(transport);\n      byteOffset = 0;\n    }\n\n    @Override\n    public void write(byte[] buf, int off, int len) throws TTransportException {\n      super.write(buf, off, len);\n      byteOffset += len;\n    }\n\n    @Override\n    public void flush() throws TTransportException {\n      super.flush();\n      // Add 4 bytes for the frame size.\n      byteOffset += 4;\n    }\n\n    public long getByteOffset() {\n      return byteOffset;\n    }\n  }\n\n  private final String fileName;\n\n  private BufferedOutputStream bufferedOutputStream;\n  private ByteOffsetTFramedTransport transport;\n  private TProtocol protocol;\n\n  public SimpleThriftLogger(String filename) throws Exception {\n    this.fileName = filename;\n    bufferedOutputStream = new BufferedOutputStream(new FileOutputStream(fileName, true));\n    transport = new ByteOffsetTFramedTransport(new TIOStreamTransport(bufferedOutputStream));\n    protocol = new TBinaryProtocol(transport);\n  }\n\n  /**\n   * Write a thrift message to log file.\n   * @param message to be written\n   * @throws Exception on write error.\n   */\n  public void logThrift(T message) throws Exception {\n    message.write(protocol);\n    // Flush to make sure one message per frame.\n    transport.flush();\n  }\n\n  /**\n   * Simple implementation of log file rotation.\n   * @throws java.io.IOException\n   */\n  public void rotate() throws IOException {\n    close();\n\n    int i = 0;\n    while (new File(String.format(\"%s.%d\", fileName, ++i)).exists()) {\n      ;\n    }\n\n    for (int j = i - 1; j >= 1; --j) {\n      FileUtils.moveFile(\n          new File(String.format(\"%s.%d\", fileName, j)),\n          new File(String.format(\"%s.%d\", fileName, j + 1)));\n    }\n    FileUtils.moveFile(new File(fileName), new File(fileName + \".1\"));\n    bufferedOutputStream = new BufferedOutputStream(new FileOutputStream(fileName, true));\n    transport = new ByteOffsetTFramedTransport(new TIOStreamTransport(bufferedOutputStream));\n    protocol = new TBinaryProtocol(transport);\n  }\n\n  public void flush() throws IOException {\n    bufferedOutputStream.flush();\n  }\n\n  public LogFile getLogFile() throws IOException {\n    long inode = SingerUtils.getFileInode(FileSystems.getDefault().getPath(fileName));\n    return new LogFile(inode);\n  }\n\n  public long getByteOffset() {\n    return transport.getByteOffset();\n  }\n\n  public void close() throws IOException {\n    transport.close();\n  }\n}\n",
    "project": "singer",
    "libraryName": "libthrift",
    "libraryGroupID": "org.apache.thrift",
    "newVersion": "0.16.0",
    "previousVersion": "0.12.0",
    "breakingCommit": "867e69e208ff59d1f8baae7ed41d3e163a51bc65"
}