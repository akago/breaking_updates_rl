{
    "absolute_path_to_file_in_container": "/jclouds/apis/byon/src/main/java/org/jclouds/byon/functions/NodesFromYamlStream.java",
    "errors": [
        {
            "line_number": 83,
            "message": "[ERROR] /jclouds/apis/byon/src/main/java/org/jclouds/byon/functions/NodesFromYamlStream.java:[83,55] incompatible types: java.lang.Class<org.jclouds.byon.functions.NodesFromYamlStream.Config> cannot be converted to org.yaml.snakeyaml.LoaderOptions",
            "additional_info": "",
            "file_name": "NodesFromYamlStream.java",
            "BCs": [],
            "Additions": [],
            "uid": "689eb91e-4970-5149-ae5f-d25d1e58a0fd"
        }
    ],
    "prompt": "\nThe following Java client code fails: \n'''java\n/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.jclouds.byon.functions;\n\nimport static com.google.common.base.Preconditions.checkState;\nimport static com.google.common.base.Throwables.propagate;\nimport static org.jclouds.util.Closeables2.closeQuietly;\n\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.util.List;\nimport java.util.Map;\n\nimport javax.inject.Singleton;\n\nimport org.jclouds.byon.Node;\nimport org.jclouds.byon.domain.YamlNode;\nimport org.yaml.snakeyaml.TypeDescription;\nimport org.yaml.snakeyaml.Yaml;\nimport org.yaml.snakeyaml.constructor.Constructor;\n\nimport com.google.common.base.Function;\nimport com.google.common.base.Functions;\nimport com.google.common.cache.CacheBuilder;\nimport com.google.common.cache.CacheLoader;\nimport com.google.common.cache.LoadingCache;\nimport com.google.common.collect.Iterables;\nimport com.google.common.collect.Maps;\nimport com.google.common.io.ByteSource;\n\n/**\n * Parses the following syntax.\n * \n * <pre>\n * nodes:\n *     - id: cluster-1:\n *       name: cluster-1\n *       description: xyz\n *       hostname: cluster-1.mydomain.com\n *       location_id: virginia\n *       os_arch: x86\n *       os_family: linux\n *       os_description: redhat\n *       os_version: 5.3\n *       group: hadoop\n *       tags:\n *           - vanilla\n *       username: kelvin\n *       credential: password_or_rsa\n *         or\n *       credential_url: password_or_rsa_file ex. resource:///id_rsa will get the classpath /id_rsa; file://path/to/id_rsa\n *       sudo_password: password\n * </pre>\n */\n@Singleton\npublic class NodesFromYamlStream implements Function<ByteSource, LoadingCache<String, Node>> {\n\n   /**\n    * Type-safe config class for YAML\n    * \n    */\n   public static class Config {\n      public List<YamlNode> nodes;\n   }\n\n   @Override\n   public LoadingCache<String, Node> apply(ByteSource source) {\n\n      Constructor constructor = new Constructor(Config.class);\n\n      TypeDescription nodeDesc = new TypeDescription(YamlNode.class);\n      nodeDesc.putListPropertyType(\"tags\", String.class);\n      constructor.addTypeDescription(nodeDesc);\n\n      TypeDescription configDesc = new TypeDescription(Config.class);\n      configDesc.putListPropertyType(\"nodes\", YamlNode.class);\n      constructor.addTypeDescription(configDesc);\n      Yaml yaml = new Yaml(constructor);\n      Config config;\n      InputStream in = null;\n      try {\n         in = source.openStream();\n         config = (Config) yaml.load(in);\n      } catch (IOException ioe) {\n         throw propagate(ioe);\n      } finally {\n         closeQuietly(in);\n      }\n      checkState(config != null, \"missing config: class\");\n      checkState(config.nodes != null, \"missing nodes: collection\");\n\n      Map<String, Node> backingMap = Maps.uniqueIndex(Iterables.transform(config.nodes, YamlNode.toNode),\n            new Function<Node, String>() {\n               public String apply(Node node) {\n                  return node.getId();\n               }\n            });\n      LoadingCache<String, Node> cache = CacheBuilder.newBuilder().build(CacheLoader.from(Functions.forMap(backingMap)));\n      for (String node : backingMap.keySet())\n         cache.getUnchecked(node);\n      return cache;\n   }\n}\n\n'''\nThe error is caused by a change in the API of the dependency: snakeyaml 1.32->2.0. \nThe new library version includes the following relevant backward incompatible changes on API. \n(API changes format: lines starting with '--' denote removed members, '++' denote added ones, '~~' denote mutations with change kind) \n\n\nThe error is triggered in the following specific lines in the previous code:\n      Constructor constructor = new Constructor(Config.class);\nwith the following error message:\n[ERROR] /jclouds/apis/byon/src/main/java/org/jclouds/byon/functions/NodesFromYamlStream.java:[83,55] incompatible types: java.lang.Class<org.jclouds.byon.functions.NodesFromYamlStream.Config> cannot be converted to org.yaml.snakeyaml.LoaderOptions\n\nPlease apply your reasoning and generate the fix following the system instruction.\n",
    "buggy_lines": "      Constructor constructor = new Constructor(Config.class);",
    "error_message": "[ERROR] /jclouds/apis/byon/src/main/java/org/jclouds/byon/functions/NodesFromYamlStream.java:[83,55] incompatible types: java.lang.Class<org.jclouds.byon.functions.NodesFromYamlStream.Config> cannot be converted to org.yaml.snakeyaml.LoaderOptions",
    "api_diff": "",
    "original_code": "/*\n * Licensed to the Apache Software Foundation (ASF) under one or more\n * contributor license agreements.  See the NOTICE file distributed with\n * this work for additional information regarding copyright ownership.\n * The ASF licenses this file to You under the Apache License, Version 2.0\n * (the \"License\"); you may not use this file except in compliance with\n * the License.  You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage org.jclouds.byon.functions;\n\nimport static com.google.common.base.Preconditions.checkState;\nimport static com.google.common.base.Throwables.propagate;\nimport static org.jclouds.util.Closeables2.closeQuietly;\n\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.util.List;\nimport java.util.Map;\n\nimport javax.inject.Singleton;\n\nimport org.jclouds.byon.Node;\nimport org.jclouds.byon.domain.YamlNode;\nimport org.yaml.snakeyaml.TypeDescription;\nimport org.yaml.snakeyaml.Yaml;\nimport org.yaml.snakeyaml.constructor.Constructor;\n\nimport com.google.common.base.Function;\nimport com.google.common.base.Functions;\nimport com.google.common.cache.CacheBuilder;\nimport com.google.common.cache.CacheLoader;\nimport com.google.common.cache.LoadingCache;\nimport com.google.common.collect.Iterables;\nimport com.google.common.collect.Maps;\nimport com.google.common.io.ByteSource;\n\n/**\n * Parses the following syntax.\n * \n * <pre>\n * nodes:\n *     - id: cluster-1:\n *       name: cluster-1\n *       description: xyz\n *       hostname: cluster-1.mydomain.com\n *       location_id: virginia\n *       os_arch: x86\n *       os_family: linux\n *       os_description: redhat\n *       os_version: 5.3\n *       group: hadoop\n *       tags:\n *           - vanilla\n *       username: kelvin\n *       credential: password_or_rsa\n *         or\n *       credential_url: password_or_rsa_file ex. resource:///id_rsa will get the classpath /id_rsa; file://path/to/id_rsa\n *       sudo_password: password\n * </pre>\n */\n@Singleton\npublic class NodesFromYamlStream implements Function<ByteSource, LoadingCache<String, Node>> {\n\n   /**\n    * Type-safe config class for YAML\n    * \n    */\n   public static class Config {\n      public List<YamlNode> nodes;\n   }\n\n   @Override\n   public LoadingCache<String, Node> apply(ByteSource source) {\n\n      Constructor constructor = new Constructor(Config.class);\n\n      TypeDescription nodeDesc = new TypeDescription(YamlNode.class);\n      nodeDesc.putListPropertyType(\"tags\", String.class);\n      constructor.addTypeDescription(nodeDesc);\n\n      TypeDescription configDesc = new TypeDescription(Config.class);\n      configDesc.putListPropertyType(\"nodes\", YamlNode.class);\n      constructor.addTypeDescription(configDesc);\n      Yaml yaml = new Yaml(constructor);\n      Config config;\n      InputStream in = null;\n      try {\n         in = source.openStream();\n         config = (Config) yaml.load(in);\n      } catch (IOException ioe) {\n         throw propagate(ioe);\n      } finally {\n         closeQuietly(in);\n      }\n      checkState(config != null, \"missing config: class\");\n      checkState(config.nodes != null, \"missing nodes: collection\");\n\n      Map<String, Node> backingMap = Maps.uniqueIndex(Iterables.transform(config.nodes, YamlNode.toNode),\n            new Function<Node, String>() {\n               public String apply(Node node) {\n                  return node.getId();\n               }\n            });\n      LoadingCache<String, Node> cache = CacheBuilder.newBuilder().build(CacheLoader.from(Functions.forMap(backingMap)));\n      for (String node : backingMap.keySet())\n         cache.getUnchecked(node);\n      return cache;\n   }\n}\n",
    "project": "jclouds",
    "libraryName": "snakeyaml",
    "libraryGroupID": "org.yaml",
    "newVersion": "2.0",
    "previousVersion": "1.32",
    "breakingCommit": "b2edf635da83fd076262a41751c6f773c17f3b76"
}