{
    "absolute_path_to_file_in_container": "/singer/thrift-logger/src/main/java/com/pinterest/singer/client/logback/AppenderUtils.java",
    "errors": [
        {
            "line_number": 30,
            "message": "[ERROR] /singer/thrift-logger/src/main/java/com/pinterest/singer/client/logback/AppenderUtils.java:[30,35] cannot find symbol",
            "additional_info": "  symbol:   class TFastFramedTransport\n  location: package org.apache.thrift.transport",
            "file_name": "AppenderUtils.java",
            "BCs": [
                {
                    "element": "org.apache.thrift.transport.TFastFramedTransport",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [
                "++ public null org.apache.thrift.transport.layered.TFastFramedTransport",
                "++ public null org.apache.thrift.transport.layered.TFastFramedTransport",
                "++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport,int)",
                "++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport,int)",
                "++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport,int,int)",
                "++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport,int,int)",
                "++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport)",
                "++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport)"
            ],
            "uid": "2aa701c6-72bb-570b-ab31-1f690a8f55e3"
        },
        {
            "line_number": 63,
            "message": "[ERROR] /singer/thrift-logger/src/main/java/com/pinterest/singer/client/logback/AppenderUtils.java:[63,29] cannot find symbol",
            "additional_info": "  symbol:   class TFastFramedTransport\n  location: class com.pinterest.singer.client.logback.AppenderUtils.LogMessageEncoder",
            "file_name": "AppenderUtils.java",
            "BCs": [
                {
                    "element": "org.apache.thrift.transport.TFastFramedTransport",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [
                "++ public null org.apache.thrift.transport.layered.TFastFramedTransport",
                "++ public null org.apache.thrift.transport.layered.TFastFramedTransport",
                "++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport,int)",
                "++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport,int)",
                "++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport,int,int)",
                "++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport,int,int)",
                "++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport)",
                "++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport)"
            ],
            "uid": "5c010922-4e61-5f23-bfc7-96414c437412"
        }
    ],
    "prompt": "\nThe following Java client code fails: \n'''java\n/**\n * Copyright 2019 Pinterest, Inc.\n * \n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * \n *    http://www.apache.org/licenses/LICENSE-2.0\n * \n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.pinterest.singer.client.logback;\n\nimport com.pinterest.singer.thrift.LogMessage;\n\nimport ch.qos.logback.core.Appender;\nimport ch.qos.logback.core.Context;\nimport ch.qos.logback.core.encoder.EncoderBase;\nimport ch.qos.logback.core.rolling.RollingFileAppender;\nimport ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP;\nimport ch.qos.logback.core.rolling.TimeBasedRollingPolicy;\nimport ch.qos.logback.core.util.FileSize;\nimport org.apache.thrift.TException;\nimport org.apache.thrift.protocol.TBinaryProtocol;\nimport org.apache.thrift.protocol.TProtocol;\nimport org.apache.thrift.transport.TFastFramedTransport;\nimport org.apache.thrift.transport.TIOStreamTransport;\nimport org.apache.thrift.transport.TTransport;\n\nimport java.io.File;\nimport java.io.IOException;\nimport java.io.OutputStream;\n\n/**\n * Utils to create logback appenders\n */\npublic class AppenderUtils {\n\n  public static final String PATH_SEP = \"/\";\n\n  private AppenderUtils() {\n  }\n\n  /**\n   * Encoder for LogMessage objects.\n   */\n  public static class LogMessageEncoder extends EncoderBase<LogMessage> {\n\n    private TTransport framedTransport;\n    private TProtocol protocol;\n    private OutputStream os;\n\n    @Override\n    public void init(OutputStream os) {\n      this.os = os;\n      // Use the TFlushingFastFramedTransport to be compatible with singer_thrift\n      // log.\n      final int bufferCapacity = 10;\n      framedTransport = new TFastFramedTransport(new TIOStreamTransport(os),\n          bufferCapacity);\n      protocol = new TBinaryProtocol(framedTransport);\n    }\n\n    @Override\n    public void doEncode(LogMessage logMessage) throws IOException {\n      try {\n        logMessage.write(protocol);\n        framedTransport.flush();\n      } catch (TException e) {\n        throw new IOException(e);\n      }\n    }\n\n    @Override\n    public void close() throws IOException {\n      framedTransport.close();\n    }\n  }\n\n  /**\n   * Create the basic thrift appender which logs to a file\n   * and rolls the file when it exceeds a certain size.\n   *\n   * @param basePath base directory the files are under.\n   * @param topic the topic name for the current appender.\n   * @param rotateThresholdKBytes threshold in kilobytes to rotate after.\n   * @param context the logback context.\n   */\n  public static Appender<LogMessage> createFileRollingThriftAppender(\n      File basePath,\n      String topic,\n      long rotateThresholdKBytes,\n      Context context,\n      int maxRetentionHours) {\n    RollingFileAppender<LogMessage> appender = new RollingFileAppender<LogMessage>();\n    appender.setContext(context);\n    appender.setAppend(true);\n    appender.setPrudent(false);\n\n    LogMessageEncoder encoder = new LogMessageEncoder();\n    appender.setEncoder(encoder);\n    appender.setFile(basePath + PATH_SEP + topic);\n\n    TimeBasedRollingPolicy policy = new TimeBasedRollingPolicy();\n    policy.setMaxHistory(maxRetentionHours);\n    policy.setFileNamePattern(basePath + PATH_SEP + topic + \".%d{yyyy-MM-dd-HH}.%i\");\n    policy.setCleanHistoryOnStart(false);\n    policy.setContext(context);\n    policy.setParent(appender);\n\n    // Also impose a max size per file policy.\n    SizeAndTimeBasedFNATP fnatp = new SizeAndTimeBasedFNATP();\n    fnatp.setContext(context);\n    fnatp.setTimeBasedRollingPolicy(policy);\n    fnatp.setMaxFileSize(FileSize.valueOf(String.format(\"%sKB\", rotateThresholdKBytes)));\n\n    policy.setTimeBasedFileNamingAndTriggeringPolicy(fnatp);\n    appender.setRollingPolicy(policy);\n    appender.setTriggeringPolicy(policy);\n\n    policy.start();\n    appender.start();\n\n    return appender;\n  }\n}\n\n'''\nThe error is caused by a change in the API of the dependency: libthrift 0.12.0->0.16.0. \nThe new library version includes the following relevant backward incompatible changes on API. \n(API changes format: lines starting with '--' denote removed members, '++' denote added ones, '~~' denote mutations with change kind) \n-- org.apache.thrift.transport.TFastFramedTransport\n++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport,int,int)\n++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport,int)\n++ public null org.apache.thrift.transport.layered.TFastFramedTransport\n++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport)\n\nThe error is triggered in the following specific lines in the previous code:\nimport org.apache.thrift.transport.TFastFramedTransport;\n      framedTransport = new TFastFramedTransport(new TIOStreamTransport(os),\nwith the following error message:\n[ERROR] /singer/thrift-logger/src/main/java/com/pinterest/singer/client/logback/AppenderUtils.java:[30,35] cannot find symbol  symbol:   class TFastFramedTransport\n  location: package org.apache.thrift.transport\n[ERROR] /singer/thrift-logger/src/main/java/com/pinterest/singer/client/logback/AppenderUtils.java:[63,29] cannot find symbol  symbol:   class TFastFramedTransport\n  location: class com.pinterest.singer.client.logback.AppenderUtils.LogMessageEncoder\n\nPlease apply your reasoning and generate the fix following the system instruction.\n",
    "buggy_lines": "import org.apache.thrift.transport.TFastFramedTransport;\n      framedTransport = new TFastFramedTransport(new TIOStreamTransport(os),",
    "error_message": "[ERROR] /singer/thrift-logger/src/main/java/com/pinterest/singer/client/logback/AppenderUtils.java:[30,35] cannot find symbol  symbol:   class TFastFramedTransport\n  location: package org.apache.thrift.transport\n[ERROR] /singer/thrift-logger/src/main/java/com/pinterest/singer/client/logback/AppenderUtils.java:[63,29] cannot find symbol  symbol:   class TFastFramedTransport\n  location: class com.pinterest.singer.client.logback.AppenderUtils.LogMessageEncoder",
    "api_diff": "-- org.apache.thrift.transport.TFastFramedTransport\n++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport,int,int)\n++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport,int)\n++ public null org.apache.thrift.transport.layered.TFastFramedTransport\n++ public TFastFramedTransport org.apache.thrift.transport.layered.TFastFramedTransport(org.apache.thrift.transport.TTransport)",
    "original_code": "/**\n * Copyright 2019 Pinterest, Inc.\n * \n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n * \n *    http://www.apache.org/licenses/LICENSE-2.0\n * \n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.pinterest.singer.client.logback;\n\nimport com.pinterest.singer.thrift.LogMessage;\n\nimport ch.qos.logback.core.Appender;\nimport ch.qos.logback.core.Context;\nimport ch.qos.logback.core.encoder.EncoderBase;\nimport ch.qos.logback.core.rolling.RollingFileAppender;\nimport ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP;\nimport ch.qos.logback.core.rolling.TimeBasedRollingPolicy;\nimport ch.qos.logback.core.util.FileSize;\nimport org.apache.thrift.TException;\nimport org.apache.thrift.protocol.TBinaryProtocol;\nimport org.apache.thrift.protocol.TProtocol;\nimport org.apache.thrift.transport.TFastFramedTransport;\nimport org.apache.thrift.transport.TIOStreamTransport;\nimport org.apache.thrift.transport.TTransport;\n\nimport java.io.File;\nimport java.io.IOException;\nimport java.io.OutputStream;\n\n/**\n * Utils to create logback appenders\n */\npublic class AppenderUtils {\n\n  public static final String PATH_SEP = \"/\";\n\n  private AppenderUtils() {\n  }\n\n  /**\n   * Encoder for LogMessage objects.\n   */\n  public static class LogMessageEncoder extends EncoderBase<LogMessage> {\n\n    private TTransport framedTransport;\n    private TProtocol protocol;\n    private OutputStream os;\n\n    @Override\n    public void init(OutputStream os) {\n      this.os = os;\n      // Use the TFlushingFastFramedTransport to be compatible with singer_thrift\n      // log.\n      final int bufferCapacity = 10;\n      framedTransport = new TFastFramedTransport(new TIOStreamTransport(os),\n          bufferCapacity);\n      protocol = new TBinaryProtocol(framedTransport);\n    }\n\n    @Override\n    public void doEncode(LogMessage logMessage) throws IOException {\n      try {\n        logMessage.write(protocol);\n        framedTransport.flush();\n      } catch (TException e) {\n        throw new IOException(e);\n      }\n    }\n\n    @Override\n    public void close() throws IOException {\n      framedTransport.close();\n    }\n  }\n\n  /**\n   * Create the basic thrift appender which logs to a file\n   * and rolls the file when it exceeds a certain size.\n   *\n   * @param basePath base directory the files are under.\n   * @param topic the topic name for the current appender.\n   * @param rotateThresholdKBytes threshold in kilobytes to rotate after.\n   * @param context the logback context.\n   */\n  public static Appender<LogMessage> createFileRollingThriftAppender(\n      File basePath,\n      String topic,\n      long rotateThresholdKBytes,\n      Context context,\n      int maxRetentionHours) {\n    RollingFileAppender<LogMessage> appender = new RollingFileAppender<LogMessage>();\n    appender.setContext(context);\n    appender.setAppend(true);\n    appender.setPrudent(false);\n\n    LogMessageEncoder encoder = new LogMessageEncoder();\n    appender.setEncoder(encoder);\n    appender.setFile(basePath + PATH_SEP + topic);\n\n    TimeBasedRollingPolicy policy = new TimeBasedRollingPolicy();\n    policy.setMaxHistory(maxRetentionHours);\n    policy.setFileNamePattern(basePath + PATH_SEP + topic + \".%d{yyyy-MM-dd-HH}.%i\");\n    policy.setCleanHistoryOnStart(false);\n    policy.setContext(context);\n    policy.setParent(appender);\n\n    // Also impose a max size per file policy.\n    SizeAndTimeBasedFNATP fnatp = new SizeAndTimeBasedFNATP();\n    fnatp.setContext(context);\n    fnatp.setTimeBasedRollingPolicy(policy);\n    fnatp.setMaxFileSize(FileSize.valueOf(String.format(\"%sKB\", rotateThresholdKBytes)));\n\n    policy.setTimeBasedFileNamingAndTriggeringPolicy(fnatp);\n    appender.setRollingPolicy(policy);\n    appender.setTriggeringPolicy(policy);\n\n    policy.start();\n    appender.start();\n\n    return appender;\n  }\n}\n",
    "project": "singer",
    "libraryName": "libthrift",
    "libraryGroupID": "org.apache.thrift",
    "newVersion": "0.16.0",
    "previousVersion": "0.12.0",
    "breakingCommit": "3572a1ecc0154c61e05505aed56055b9c5e539a6"
}