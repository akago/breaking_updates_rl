{
    "absolute_path_to_file_in_container": "/depclean/depclean-core/src/main/java/se/kth/depclean/core/util/JarUtils.java",
    "errors": [
        {
            "line_number": 60,
            "message": "[ERROR] /depclean/depclean-core/src/main/java/se/kth/depclean/core/util/JarUtils.java:[60,11] cannot find symbol",
            "additional_info": "  symbol:   variable log\n  location: class se.kth.depclean.core.util.JarUtils",
            "file_name": "JarUtils.java",
            "BCs": [],
            "Additions": [],
            "uid": "38a62fda-9b95-5a51-8c5d-7ca7f67bb47b"
        },
        {
            "line_number": 61,
            "message": "[ERROR] /depclean/depclean-core/src/main/java/se/kth/depclean/core/util/JarUtils.java:[61,11] cannot find symbol",
            "additional_info": "  symbol:   variable log\n  location: class se.kth.depclean.core.util.JarUtils",
            "file_name": "JarUtils.java",
            "BCs": [],
            "Additions": [],
            "uid": "38a62fda-9b95-5a51-8c5d-7ca7f67bb47b"
        }
    ],
    "prompt": "\nThe following Java client code fails: \n'''java\n/*\n * Copyright (c) 2020, CASTOR Software Research Centre (www.castor.kth.se)\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT\n * NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL\n * THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)\n * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,\n * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED\n * OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\npackage se.kth.depclean.core.util;\n\nimport java.io.BufferedInputStream;\nimport java.io.BufferedOutputStream;\nimport java.io.File;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.util.Enumeration;\nimport java.util.Objects;\nimport java.util.zip.ZipEntry;\nimport java.util.zip.ZipFile;\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.commons.io.FileUtils;\n\n/**\n * Utility class to handle JAR files.\n */\n@Slf4j\npublic final class JarUtils {\n\n  /**\n   * Size of the buffer to read/write data.\n   */\n  private static final int BUFFER_SIZE = 16384;\n\n  private JarUtils() {\n  }\n\n  /**\n   * Decompress all JAR files located in a given directory.\n   *\n   * @param outputDirectory The directory path to put the decompressed files.\n   */\n  public static void decompress(final String outputDirectory) {\n    File files = new File(outputDirectory);\n    for (File f : Objects.requireNonNull(files.listFiles())) {\n      if (f.getName().endsWith(\".jar\") || f.getName().endsWith(\".war\") || f.getName().endsWith(\".ear\")) {\n        try {\n          JarUtils.decompressDependencyFiles(f.getAbsolutePath());\n          // delete the original dependency jar file\n          FileUtils.forceDelete(f);\n        } catch (IOException e) {\n          log.warn(\"Problem decompressing jar file: \" + f.getAbsolutePath());\n          log.error(e.getMessage(), e);\n        }\n      }\n    }\n  }\n\n  /**\n   * Decompress all JAR/WAR/EAR files withing a file (recursively).\n   *\n   * @param zipFile The file to be decompressed.\n   */\n  private static void decompressDependencyFiles(String zipFile) throws IOException {\n    File file = new File(zipFile);\n    try (ZipFile zip = new ZipFile(file)) {\n      String newPath = zipFile.substring(0, zipFile.length() - 4);\n      new File(newPath).mkdir();\n      Enumeration<? extends ZipEntry> zipFileEntries = zip.entries();\n      // Process each entry\n      while (zipFileEntries.hasMoreElements()) {\n        // grab a zip file entry\n        ZipEntry entry = zipFileEntries.nextElement();\n        String currentEntry = entry.getName();\n        File destFile = new File(newPath, currentEntry);\n        // Sonar javasecurity:S6096\n        if (!destFile.getCanonicalPath().startsWith(new File(newPath).getCanonicalPath())) {\n          throw new IOException(\"Entry is outside of the target directory\");\n        }\n        File destinationParent = destFile.getParentFile();\n        // create the parent directory structure if needed\n        destinationParent.mkdirs();\n        if (!entry.isDirectory() && !destFile.isDirectory()) {\n          BufferedInputStream is = new BufferedInputStream(zip.getInputStream(entry));\n          int currentByte;\n          // establish buffer for writing file\n          byte[] data = new byte[BUFFER_SIZE];\n          // write the current file to disk\n          FileOutputStream fos = new FileOutputStream(destFile);\n          try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {\n            // read and write until last byte is encountered\n            while ((currentByte = is.read(data, 0, BUFFER_SIZE)) != -1) {\n              dest.write(data, 0, currentByte);\n            }\n            dest.flush();\n            is.close();\n          }\n        }\n        if (currentEntry.endsWith(\".jar\") || currentEntry.endsWith(\".war\") || currentEntry.endsWith(\".ear\")) {\n          // found a zip file, try to open\n          decompressDependencyFiles(destFile.getAbsolutePath());\n          FileUtils.forceDelete(new File(destFile.getAbsolutePath()));\n        }\n      }\n    }\n  }\n\n\n}\n\n'''\nThe error is caused by a change in the API of the dependency: guava 31.1-jre->32.0.0-android. \nThe new library version includes the following relevant backward incompatible changes on API. \n(API changes format: lines starting with '--' denote removed members, '++' denote added ones, '~~' denote mutations with change kind) \n-- com.google.common.collect.ImmutableSet.toImmutableSet\n-- com.google.common.collect.ImmutableSortedSetFauxverideShim.toImmutableSet\n\nThe error is triggered in the following specific lines in the previous code:\n          log.warn(\"Problem decompressing jar file: \" + f.getAbsolutePath());\n          log.error(e.getMessage(), e);\nwith the following error message:\n[ERROR] /depclean/depclean-core/src/main/java/se/kth/depclean/core/util/JarUtils.java:[60,11] cannot find symbol  symbol:   variable log\n  location: class se.kth.depclean.core.util.JarUtils\n[ERROR] /depclean/depclean-core/src/main/java/se/kth/depclean/core/util/JarUtils.java:[61,11] cannot find symbol  symbol:   variable log\n  location: class se.kth.depclean.core.util.JarUtils\n\nPlease apply your reasoning and generate the fix following the system instruction.\n",
    "buggy_lines": "          log.warn(\"Problem decompressing jar file: \" + f.getAbsolutePath());\n          log.error(e.getMessage(), e);",
    "error_message": "[ERROR] /depclean/depclean-core/src/main/java/se/kth/depclean/core/util/JarUtils.java:[60,11] cannot find symbol  symbol:   variable log\n  location: class se.kth.depclean.core.util.JarUtils\n[ERROR] /depclean/depclean-core/src/main/java/se/kth/depclean/core/util/JarUtils.java:[61,11] cannot find symbol  symbol:   variable log\n  location: class se.kth.depclean.core.util.JarUtils",
    "api_diff": "-- com.google.common.collect.ImmutableSet.toImmutableSet\n-- com.google.common.collect.ImmutableSortedSetFauxverideShim.toImmutableSet",
    "original_code": "/*\n * Copyright (c) 2020, CASTOR Software Research Centre (www.castor.kth.se)\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT\n * NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND\n * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL\n * THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)\n * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,\n * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED\n * OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\npackage se.kth.depclean.core.util;\n\nimport java.io.BufferedInputStream;\nimport java.io.BufferedOutputStream;\nimport java.io.File;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.util.Enumeration;\nimport java.util.Objects;\nimport java.util.zip.ZipEntry;\nimport java.util.zip.ZipFile;\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.commons.io.FileUtils;\n\n/**\n * Utility class to handle JAR files.\n */\n@Slf4j\npublic final class JarUtils {\n\n  /**\n   * Size of the buffer to read/write data.\n   */\n  private static final int BUFFER_SIZE = 16384;\n\n  private JarUtils() {\n  }\n\n  /**\n   * Decompress all JAR files located in a given directory.\n   *\n   * @param outputDirectory The directory path to put the decompressed files.\n   */\n  public static void decompress(final String outputDirectory) {\n    File files = new File(outputDirectory);\n    for (File f : Objects.requireNonNull(files.listFiles())) {\n      if (f.getName().endsWith(\".jar\") || f.getName().endsWith(\".war\") || f.getName().endsWith(\".ear\")) {\n        try {\n          JarUtils.decompressDependencyFiles(f.getAbsolutePath());\n          // delete the original dependency jar file\n          FileUtils.forceDelete(f);\n        } catch (IOException e) {\n          log.warn(\"Problem decompressing jar file: \" + f.getAbsolutePath());\n          log.error(e.getMessage(), e);\n        }\n      }\n    }\n  }\n\n  /**\n   * Decompress all JAR/WAR/EAR files withing a file (recursively).\n   *\n   * @param zipFile The file to be decompressed.\n   */\n  private static void decompressDependencyFiles(String zipFile) throws IOException {\n    File file = new File(zipFile);\n    try (ZipFile zip = new ZipFile(file)) {\n      String newPath = zipFile.substring(0, zipFile.length() - 4);\n      new File(newPath).mkdir();\n      Enumeration<? extends ZipEntry> zipFileEntries = zip.entries();\n      // Process each entry\n      while (zipFileEntries.hasMoreElements()) {\n        // grab a zip file entry\n        ZipEntry entry = zipFileEntries.nextElement();\n        String currentEntry = entry.getName();\n        File destFile = new File(newPath, currentEntry);\n        // Sonar javasecurity:S6096\n        if (!destFile.getCanonicalPath().startsWith(new File(newPath).getCanonicalPath())) {\n          throw new IOException(\"Entry is outside of the target directory\");\n        }\n        File destinationParent = destFile.getParentFile();\n        // create the parent directory structure if needed\n        destinationParent.mkdirs();\n        if (!entry.isDirectory() && !destFile.isDirectory()) {\n          BufferedInputStream is = new BufferedInputStream(zip.getInputStream(entry));\n          int currentByte;\n          // establish buffer for writing file\n          byte[] data = new byte[BUFFER_SIZE];\n          // write the current file to disk\n          FileOutputStream fos = new FileOutputStream(destFile);\n          try (BufferedOutputStream dest = new BufferedOutputStream(fos, BUFFER_SIZE)) {\n            // read and write until last byte is encountered\n            while ((currentByte = is.read(data, 0, BUFFER_SIZE)) != -1) {\n              dest.write(data, 0, currentByte);\n            }\n            dest.flush();\n            is.close();\n          }\n        }\n        if (currentEntry.endsWith(\".jar\") || currentEntry.endsWith(\".war\") || currentEntry.endsWith(\".ear\")) {\n          // found a zip file, try to open\n          decompressDependencyFiles(destFile.getAbsolutePath());\n          FileUtils.forceDelete(new File(destFile.getAbsolutePath()));\n        }\n      }\n    }\n  }\n\n\n}\n",
    "project": "depclean",
    "libraryName": "guava",
    "libraryGroupID": "com.google.guava",
    "newVersion": "32.0.0-android",
    "previousVersion": "31.1-jre",
    "breakingCommit": "b86a5f84b44a9b50aee69745886c47123f721de3"
}