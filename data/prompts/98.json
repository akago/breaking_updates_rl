{
    "absolute_path_to_file_in_container": "/XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java",
    "errors": [
        {
            "line_number": 15,
            "message": "[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[15,53] cannot find symbol",
            "additional_info": "  symbol:   class PNMembershipResult\n  location: package com.pubnub.api.models.consumer.pubsub.objects",
            "file_name": "PubnubStreamingService.java",
            "BCs": [
                {
                    "element": "com.pubnub.api.models.consumer.pubsub.objects.PNMembershipResult",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [
                "++ public null com.pubnub.api.models.consumer.objects_api.membership.PNMembershipResult",
                "++ public null com.pubnub.api.models.consumer.objects_api.membership.PNMembershipResult",
                "++ public PNMembershipResult com.pubnub.api.models.consumer.objects_api.membership.PNMembershipResult(com.pubnub.api.models.consumer.pubsub.BasePubSubResult,java.lang.String,com.pubnub.api.models.consumer.objects_api.membership.PNMembership)",
                "++ public PNMembershipResult com.pubnub.api.models.consumer.objects_api.membership.PNMembershipResult(com.pubnub.api.models.consumer.pubsub.BasePubSubResult,java.lang.String,com.pubnub.api.models.consumer.objects_api.membership.PNMembership)"
            ],
            "uid": "fb964469-c060-515c-9e22-fa47bcab701e"
        },
        {
            "line_number": 16,
            "message": "[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[16,53] cannot find symbol",
            "additional_info": "  symbol:   class PNSpaceResult\n  location: package com.pubnub.api.models.consumer.pubsub.objects",
            "file_name": "PubnubStreamingService.java",
            "BCs": [
                {
                    "element": "com.pubnub.api.models.consumer.pubsub.objects.PNSpaceResult",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [],
            "uid": "c4a6ed06-b9c4-5be9-acf8-be813d61f42c"
        },
        {
            "line_number": 17,
            "message": "[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[17,53] cannot find symbol",
            "additional_info": "  symbol:   class PNUserResult\n  location: package com.pubnub.api.models.consumer.pubsub.objects",
            "file_name": "PubnubStreamingService.java",
            "BCs": [
                {
                    "element": "com.pubnub.api.models.consumer.pubsub.objects.PNUserResult",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [],
            "uid": "3eb72a92-182f-5e72-a8f9-1885e1ab817d"
        },
        {
            "line_number": 40,
            "message": "[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[40,39] no suitable constructor found for PNConfiguration(no arguments)",
            "additional_info": "    constructor com.pubnub.api.PNConfiguration.PNConfiguration(com.pubnub.api.UserId) is not applicable\n      (actual and formal argument lists differ in length)\n    constructor com.pubnub.api.PNConfiguration.PNConfiguration(java.lang.String) is not applicable\n      (actual and formal argument lists differ in length)",
            "file_name": "PubnubStreamingService.java",
            "BCs": [],
            "Additions": [],
            "uid": "de574909-806f-5e49-b225-765a6dce49db"
        },
        {
            "line_number": 50,
            "message": "[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[50,39] <anonymous info.bitrich.xchangestream.service.pubnub.PubnubStreamingService$1> is not abstract and does not override abstract method file(com.pubnub.api.PubNub,com.pubnub.api.models.consumer.pubsub.files.PNFileEventResult) in com.pubnub.api.callbacks.SubscribeCallback",
            "additional_info": "",
            "file_name": "PubnubStreamingService.java",
            "BCs": [
                {
                    "element": "com.pubnub.api.callbacks.SubscribeCallback",
                    "nature": "ADDITION",
                    "kind": "METHOD_ABSTRACT_ADDED_TO_CLASS"
                }
            ],
            "Additions": [],
            "uid": "947e12de-7184-5bd0-bd4a-88f0f05c6230"
        },
        {
            "line_number": 93,
            "message": "[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[93,17] method does not override or implement a method from a supertype",
            "additional_info": "",
            "file_name": "PubnubStreamingService.java",
            "BCs": [],
            "Additions": [],
            "uid": "54c0b9a1-0900-52ce-a40e-e3b60da107a5"
        },
        {
            "line_number": 94,
            "message": "[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[94,49] cannot find symbol",
            "additional_info": "  symbol: class PNUserResult",
            "file_name": "PubnubStreamingService.java",
            "BCs": [
                {
                    "element": "com.pubnub.api.models.consumer.pubsub.objects.PNUserResult",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [],
            "uid": "d2da2bc4-46ac-5d90-a160-415cb3f906dd"
        },
        {
            "line_number": 98,
            "message": "[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[98,17] method does not override or implement a method from a supertype",
            "additional_info": "",
            "file_name": "PubnubStreamingService.java",
            "BCs": [],
            "Additions": [],
            "uid": "54c0b9a1-0900-52ce-a40e-e3b60da107a5"
        },
        {
            "line_number": 99,
            "message": "[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[99,50] cannot find symbol",
            "additional_info": "  symbol: class PNSpaceResult",
            "file_name": "PubnubStreamingService.java",
            "BCs": [
                {
                    "element": "com.pubnub.api.models.consumer.pubsub.objects.PNSpaceResult",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [],
            "uid": "e11b5e24-9148-5bb2-8c87-a7a23342f897"
        },
        {
            "line_number": 104,
            "message": "[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[104,55] cannot find symbol",
            "additional_info": "  symbol: class PNMembershipResult",
            "file_name": "PubnubStreamingService.java",
            "BCs": [
                {
                    "element": "com.pubnub.api.models.consumer.pubsub.objects.PNMembershipResult",
                    "nature": "DELETION",
                    "kind": "TYPE_REMOVED"
                }
            ],
            "Additions": [
                "++ public null com.pubnub.api.models.consumer.objects_api.membership.PNMembershipResult",
                "++ public null com.pubnub.api.models.consumer.objects_api.membership.PNMembershipResult",
                "++ public PNMembershipResult com.pubnub.api.models.consumer.objects_api.membership.PNMembershipResult(com.pubnub.api.models.consumer.pubsub.BasePubSubResult,java.lang.String,com.pubnub.api.models.consumer.objects_api.membership.PNMembership)",
                "++ public PNMembershipResult com.pubnub.api.models.consumer.objects_api.membership.PNMembershipResult(com.pubnub.api.models.consumer.pubsub.BasePubSubResult,java.lang.String,com.pubnub.api.models.consumer.objects_api.membership.PNMembership)"
            ],
            "uid": "f6277aa2-b959-5fd5-b4f8-8d4996568198"
        }
    ],
    "prompt": "\nThe following Java client code fails: \n'''java\npackage info.bitrich.xchangestream.service.pubnub;\n\nimport com.fasterxml.jackson.databind.DeserializationFeature;\nimport com.fasterxml.jackson.databind.JsonNode;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.pubnub.api.PNConfiguration;\nimport com.pubnub.api.PubNub;\nimport com.pubnub.api.callbacks.SubscribeCallback;\nimport com.pubnub.api.enums.PNStatusCategory;\nimport com.pubnub.api.models.consumer.PNStatus;\nimport com.pubnub.api.models.consumer.pubsub.PNMessageResult;\nimport com.pubnub.api.models.consumer.pubsub.PNPresenceEventResult;\nimport com.pubnub.api.models.consumer.pubsub.PNSignalResult;\nimport com.pubnub.api.models.consumer.pubsub.message_actions.PNMessageActionResult;\nimport com.pubnub.api.models.consumer.pubsub.objects.PNMembershipResult;\nimport com.pubnub.api.models.consumer.pubsub.objects.PNSpaceResult;\nimport com.pubnub.api.models.consumer.pubsub.objects.PNUserResult;\nimport io.reactivex.Completable;\nimport io.reactivex.Observable;\nimport io.reactivex.ObservableEmitter;\nimport java.io.IOException;\nimport java.util.Collections;\nimport java.util.Map;\nimport java.util.concurrent.ConcurrentHashMap;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\n/** Created by Lukas Zaoralek on 14.11.17. */\npublic class PubnubStreamingService {\n  private static final Logger LOG = LoggerFactory.getLogger(PubnubStreamingService.class);\n\n  private final PubNub pubnub;\n  private PNStatusCategory pnStatusCategory;\n  private final Map<String, ObservableEmitter<JsonNode>> subscriptions = new ConcurrentHashMap<>();\n  private final ObjectMapper mapper;\n\n  public PubnubStreamingService(String publicKey) {\n    mapper = new ObjectMapper();\n    mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);\n    PNConfiguration pnConfiguration = new PNConfiguration();\n    pnConfiguration.setSubscribeKey(publicKey);\n    pubnub = new PubNub(pnConfiguration);\n    pnStatusCategory = PNStatusCategory.PNDisconnectedCategory;\n  }\n\n  public Completable connect() {\n    return Completable.create(\n        e -> {\n          pubnub.addListener(\n              new SubscribeCallback() {\n                @Override\n                public void status(PubNub pubNub, PNStatus pnStatus) {\n                  pnStatusCategory = pnStatus.getCategory();\n                  LOG.debug(\n                      \"PubNub status: {} {}\",\n                      pnStatusCategory.toString(),\n                      pnStatus.getStatusCode());\n                  if (pnStatusCategory == PNStatusCategory.PNConnectedCategory) {\n                    //              e.onComplete();\n                  } else if (pnStatus.isError()) {\n                    //              e.onError(pnStatus.getErrorData().getThrowable());\n                  }\n                }\n\n                @Override\n                public void message(PubNub pubNub, PNMessageResult pnMessageResult) {\n                  String channelName = pnMessageResult.getChannel();\n                  ObservableEmitter<JsonNode> subscription = subscriptions.get(channelName);\n                  LOG.debug(\"PubNub Message: {}\", pnMessageResult.toString());\n                  if (subscription != null) {\n                    JsonNode jsonMessage = null;\n                    try {\n                      jsonMessage = mapper.readTree(pnMessageResult.getMessage().toString());\n                    } catch (IOException ex) {\n                      ex.printStackTrace();\n                    }\n                    subscription.onNext(jsonMessage);\n                  } else {\n                    LOG.debug(\"No subscriber for channel {}.\", channelName);\n                  }\n                }\n\n                @Override\n                public void presence(PubNub pubNub, PNPresenceEventResult pnPresenceEventResult) {\n                  LOG.debug(\"PubNub presence: {}\", pnPresenceEventResult.toString());\n                }\n\n                @Override\n                public void signal(PubNub pubnub, PNSignalResult pnSignalResult) {\n                  LOG.debug(\"PubNub signal: {}\", pnSignalResult.toString());\n                }\n\n                @Override\n                public void user(PubNub pubnub, PNUserResult pnUserResult) {\n                  LOG.debug(\"PubNub user: {}\", pnUserResult.toString());\n                }\n\n                @Override\n                public void space(PubNub pubnub, PNSpaceResult pnSpaceResult) {\n                  LOG.debug(\"PubNub space: {}\", pnSpaceResult.toString());\n                }\n\n                @Override\n                public void membership(PubNub pubnub, PNMembershipResult pnMembershipResult) {\n                  LOG.debug(\"PubNub membership: {}\", pnMembershipResult.toString());\n                }\n\n                @Override\n                public void messageAction(\n                    PubNub pubnub, PNMessageActionResult pnMessageActionResult) {\n                  LOG.debug(\"PubNub messageAction: {}\", pnMessageActionResult.toString());\n                }\n              });\n          e.onComplete();\n        });\n  }\n\n  public Observable<JsonNode> subscribeChannel(String channelName) {\n    LOG.info(\"Subscribing to channel {}.\", channelName);\n    return Observable.<JsonNode>create(\n            e -> {\n              if (!subscriptions.containsKey(channelName)) {\n                subscriptions.put(channelName, e);\n                pubnub.subscribe().channels(Collections.singletonList(channelName)).execute();\n                LOG.debug(\"Subscribe channel: {}\", channelName);\n              }\n            })\n        .doOnDispose(\n            () -> {\n              LOG.debug(\"Unsubscribe channel: {}\", channelName);\n              pubnub.unsubscribe().channels(Collections.singletonList(channelName)).execute();\n            })\n        .share();\n  }\n\n  public Completable disconnect() {\n    return Completable.create(\n        completable -> {\n          pubnub.disconnect();\n          completable.onComplete();\n        });\n  }\n\n  public boolean isAlive() {\n    return (pnStatusCategory == PNStatusCategory.PNConnectedCategory);\n  }\n\n  public void useCompressedMessages(boolean compressedMessages) {\n    throw new UnsupportedOperationException();\n  }\n}\n\n'''\nThe error is caused by a change in the API of the dependency: pubnub-gson 4.31.3->6.3.2. \nThe new library version includes the following relevant backward incompatible changes on API. \n(API changes format: lines starting with '--' denote removed members, '++' denote added ones, '~~' denote mutations with change kind) \n-- com.pubnub.api.models.consumer.pubsub.objects.PNMembershipResult\n-- com.pubnub.api.models.consumer.pubsub.objects.PNSpaceResult\n-- com.pubnub.api.models.consumer.pubsub.objects.PNUserResult\n++ METHOD_ABSTRACT_ADDED_TO_CLASS <- com.pubnub.api.callbacks.SubscribeCallback\n++ public null com.pubnub.api.models.consumer.objects_api.membership.PNMembershipResult\n++ public PNMembershipResult com.pubnub.api.models.consumer.objects_api.membership.PNMembershipResult(com.pubnub.api.models.consumer.pubsub.BasePubSubResult,java.lang.String,com.pubnub.api.models.consumer.objects_api.membership.PNMembership)\n\nThe error is triggered in the following specific lines in the previous code:\nimport com.pubnub.api.models.consumer.pubsub.objects.PNMembershipResult;\nimport com.pubnub.api.models.consumer.pubsub.objects.PNSpaceResult;\nimport com.pubnub.api.models.consumer.pubsub.objects.PNUserResult;\n    PNConfiguration pnConfiguration = new PNConfiguration();\n              new SubscribeCallback() {\n                @Override\n                public void user(PubNub pubnub, PNUserResult pnUserResult) {\n                @Override\n                public void space(PubNub pubnub, PNSpaceResult pnSpaceResult) {\n                public void membership(PubNub pubnub, PNMembershipResult pnMembershipResult) {\nwith the following error message:\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[15,53] cannot find symbol  symbol:   class PNMembershipResult\n  location: package com.pubnub.api.models.consumer.pubsub.objects\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[16,53] cannot find symbol  symbol:   class PNSpaceResult\n  location: package com.pubnub.api.models.consumer.pubsub.objects\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[17,53] cannot find symbol  symbol:   class PNUserResult\n  location: package com.pubnub.api.models.consumer.pubsub.objects\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[40,39] no suitable constructor found for PNConfiguration(no arguments)    constructor com.pubnub.api.PNConfiguration.PNConfiguration(com.pubnub.api.UserId) is not applicable\n      (actual and formal argument lists differ in length)\n    constructor com.pubnub.api.PNConfiguration.PNConfiguration(java.lang.String) is not applicable\n      (actual and formal argument lists differ in length)\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[50,39] <anonymous info.bitrich.xchangestream.service.pubnub.PubnubStreamingService$1> is not abstract and does not override abstract method file(com.pubnub.api.PubNub,com.pubnub.api.models.consumer.pubsub.files.PNFileEventResult) in com.pubnub.api.callbacks.SubscribeCallback\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[93,17] method does not override or implement a method from a supertype\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[94,49] cannot find symbol  symbol: class PNUserResult\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[98,17] method does not override or implement a method from a supertype\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[99,50] cannot find symbol  symbol: class PNSpaceResult\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[104,55] cannot find symbol  symbol: class PNMembershipResult\n\nPlease apply your reasoning and generate the fix following the system instruction.\n",
    "buggy_lines": "import com.pubnub.api.models.consumer.pubsub.objects.PNMembershipResult;\nimport com.pubnub.api.models.consumer.pubsub.objects.PNSpaceResult;\nimport com.pubnub.api.models.consumer.pubsub.objects.PNUserResult;\n    PNConfiguration pnConfiguration = new PNConfiguration();\n              new SubscribeCallback() {\n                @Override\n                public void user(PubNub pubnub, PNUserResult pnUserResult) {\n                @Override\n                public void space(PubNub pubnub, PNSpaceResult pnSpaceResult) {\n                public void membership(PubNub pubnub, PNMembershipResult pnMembershipResult) {",
    "error_message": "[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[15,53] cannot find symbol  symbol:   class PNMembershipResult\n  location: package com.pubnub.api.models.consumer.pubsub.objects\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[16,53] cannot find symbol  symbol:   class PNSpaceResult\n  location: package com.pubnub.api.models.consumer.pubsub.objects\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[17,53] cannot find symbol  symbol:   class PNUserResult\n  location: package com.pubnub.api.models.consumer.pubsub.objects\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[40,39] no suitable constructor found for PNConfiguration(no arguments)    constructor com.pubnub.api.PNConfiguration.PNConfiguration(com.pubnub.api.UserId) is not applicable\n      (actual and formal argument lists differ in length)\n    constructor com.pubnub.api.PNConfiguration.PNConfiguration(java.lang.String) is not applicable\n      (actual and formal argument lists differ in length)\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[50,39] <anonymous info.bitrich.xchangestream.service.pubnub.PubnubStreamingService$1> is not abstract and does not override abstract method file(com.pubnub.api.PubNub,com.pubnub.api.models.consumer.pubsub.files.PNFileEventResult) in com.pubnub.api.callbacks.SubscribeCallback\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[93,17] method does not override or implement a method from a supertype\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[94,49] cannot find symbol  symbol: class PNUserResult\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[98,17] method does not override or implement a method from a supertype\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[99,50] cannot find symbol  symbol: class PNSpaceResult\n[ERROR] /XChange/xchange-stream-service-pubnub/src/main/java/info/bitrich/xchangestream/service/pubnub/PubnubStreamingService.java:[104,55] cannot find symbol  symbol: class PNMembershipResult",
    "api_diff": "-- com.pubnub.api.models.consumer.pubsub.objects.PNMembershipResult\n-- com.pubnub.api.models.consumer.pubsub.objects.PNSpaceResult\n-- com.pubnub.api.models.consumer.pubsub.objects.PNUserResult\n++ METHOD_ABSTRACT_ADDED_TO_CLASS <- com.pubnub.api.callbacks.SubscribeCallback\n++ public null com.pubnub.api.models.consumer.objects_api.membership.PNMembershipResult\n++ public PNMembershipResult com.pubnub.api.models.consumer.objects_api.membership.PNMembershipResult(com.pubnub.api.models.consumer.pubsub.BasePubSubResult,java.lang.String,com.pubnub.api.models.consumer.objects_api.membership.PNMembership)",
    "original_code": "package info.bitrich.xchangestream.service.pubnub;\n\nimport com.fasterxml.jackson.databind.DeserializationFeature;\nimport com.fasterxml.jackson.databind.JsonNode;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport com.pubnub.api.PNConfiguration;\nimport com.pubnub.api.PubNub;\nimport com.pubnub.api.callbacks.SubscribeCallback;\nimport com.pubnub.api.enums.PNStatusCategory;\nimport com.pubnub.api.models.consumer.PNStatus;\nimport com.pubnub.api.models.consumer.pubsub.PNMessageResult;\nimport com.pubnub.api.models.consumer.pubsub.PNPresenceEventResult;\nimport com.pubnub.api.models.consumer.pubsub.PNSignalResult;\nimport com.pubnub.api.models.consumer.pubsub.message_actions.PNMessageActionResult;\nimport com.pubnub.api.models.consumer.pubsub.objects.PNMembershipResult;\nimport com.pubnub.api.models.consumer.pubsub.objects.PNSpaceResult;\nimport com.pubnub.api.models.consumer.pubsub.objects.PNUserResult;\nimport io.reactivex.Completable;\nimport io.reactivex.Observable;\nimport io.reactivex.ObservableEmitter;\nimport java.io.IOException;\nimport java.util.Collections;\nimport java.util.Map;\nimport java.util.concurrent.ConcurrentHashMap;\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\n/** Created by Lukas Zaoralek on 14.11.17. */\npublic class PubnubStreamingService {\n  private static final Logger LOG = LoggerFactory.getLogger(PubnubStreamingService.class);\n\n  private final PubNub pubnub;\n  private PNStatusCategory pnStatusCategory;\n  private final Map<String, ObservableEmitter<JsonNode>> subscriptions = new ConcurrentHashMap<>();\n  private final ObjectMapper mapper;\n\n  public PubnubStreamingService(String publicKey) {\n    mapper = new ObjectMapper();\n    mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);\n    PNConfiguration pnConfiguration = new PNConfiguration();\n    pnConfiguration.setSubscribeKey(publicKey);\n    pubnub = new PubNub(pnConfiguration);\n    pnStatusCategory = PNStatusCategory.PNDisconnectedCategory;\n  }\n\n  public Completable connect() {\n    return Completable.create(\n        e -> {\n          pubnub.addListener(\n              new SubscribeCallback() {\n                @Override\n                public void status(PubNub pubNub, PNStatus pnStatus) {\n                  pnStatusCategory = pnStatus.getCategory();\n                  LOG.debug(\n                      \"PubNub status: {} {}\",\n                      pnStatusCategory.toString(),\n                      pnStatus.getStatusCode());\n                  if (pnStatusCategory == PNStatusCategory.PNConnectedCategory) {\n                    //              e.onComplete();\n                  } else if (pnStatus.isError()) {\n                    //              e.onError(pnStatus.getErrorData().getThrowable());\n                  }\n                }\n\n                @Override\n                public void message(PubNub pubNub, PNMessageResult pnMessageResult) {\n                  String channelName = pnMessageResult.getChannel();\n                  ObservableEmitter<JsonNode> subscription = subscriptions.get(channelName);\n                  LOG.debug(\"PubNub Message: {}\", pnMessageResult.toString());\n                  if (subscription != null) {\n                    JsonNode jsonMessage = null;\n                    try {\n                      jsonMessage = mapper.readTree(pnMessageResult.getMessage().toString());\n                    } catch (IOException ex) {\n                      ex.printStackTrace();\n                    }\n                    subscription.onNext(jsonMessage);\n                  } else {\n                    LOG.debug(\"No subscriber for channel {}.\", channelName);\n                  }\n                }\n\n                @Override\n                public void presence(PubNub pubNub, PNPresenceEventResult pnPresenceEventResult) {\n                  LOG.debug(\"PubNub presence: {}\", pnPresenceEventResult.toString());\n                }\n\n                @Override\n                public void signal(PubNub pubnub, PNSignalResult pnSignalResult) {\n                  LOG.debug(\"PubNub signal: {}\", pnSignalResult.toString());\n                }\n\n                @Override\n                public void user(PubNub pubnub, PNUserResult pnUserResult) {\n                  LOG.debug(\"PubNub user: {}\", pnUserResult.toString());\n                }\n\n                @Override\n                public void space(PubNub pubnub, PNSpaceResult pnSpaceResult) {\n                  LOG.debug(\"PubNub space: {}\", pnSpaceResult.toString());\n                }\n\n                @Override\n                public void membership(PubNub pubnub, PNMembershipResult pnMembershipResult) {\n                  LOG.debug(\"PubNub membership: {}\", pnMembershipResult.toString());\n                }\n\n                @Override\n                public void messageAction(\n                    PubNub pubnub, PNMessageActionResult pnMessageActionResult) {\n                  LOG.debug(\"PubNub messageAction: {}\", pnMessageActionResult.toString());\n                }\n              });\n          e.onComplete();\n        });\n  }\n\n  public Observable<JsonNode> subscribeChannel(String channelName) {\n    LOG.info(\"Subscribing to channel {}.\", channelName);\n    return Observable.<JsonNode>create(\n            e -> {\n              if (!subscriptions.containsKey(channelName)) {\n                subscriptions.put(channelName, e);\n                pubnub.subscribe().channels(Collections.singletonList(channelName)).execute();\n                LOG.debug(\"Subscribe channel: {}\", channelName);\n              }\n            })\n        .doOnDispose(\n            () -> {\n              LOG.debug(\"Unsubscribe channel: {}\", channelName);\n              pubnub.unsubscribe().channels(Collections.singletonList(channelName)).execute();\n            })\n        .share();\n  }\n\n  public Completable disconnect() {\n    return Completable.create(\n        completable -> {\n          pubnub.disconnect();\n          completable.onComplete();\n        });\n  }\n\n  public boolean isAlive() {\n    return (pnStatusCategory == PNStatusCategory.PNConnectedCategory);\n  }\n\n  public void useCompressedMessages(boolean compressedMessages) {\n    throw new UnsupportedOperationException();\n  }\n}\n",
    "project": "XChange",
    "libraryName": "pubnub-gson",
    "libraryGroupID": "com.pubnub",
    "newVersion": "6.3.2",
    "previousVersion": "4.31.3",
    "breakingCommit": "f714a41f0ffe9720939d4980da5119d1f45bd770"
}